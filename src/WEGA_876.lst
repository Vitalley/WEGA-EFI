MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001         list      p=16f876a          ; list directive to define processor
                      00002         #include <p16F876a.inc>       ; processor specific variable definitions
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F876A processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00524         LIST
                      00003         errorlevel  -302              ; suppress message 302 from list file
                      00004         #include macro.asm
                      00001 jz      macro   LBL     
                      00002         btfsc   STATUS,Z
                      00003         goto    LBL
                      00004         endm
                      00005 jnz     macro   LBL     
                      00006         btfss   STATUS,Z
                      00007         goto    LBL
                      00008         endm
                      00009 jc      macro   LBL     
                      00010         btfss   STATUS,C
                      00011         goto    LBL
                      00012         endm
                      00013 jnc     macro   LBL     
                      00014         btfsc   STATUS,C
                      00015         goto    LBL
                      00016         endm
                      00017 bank0   macro
                      00018         bcf     STATUS,RP0
                      00019         bcf     STATUS,RP1
                      00020         endm
                      00021 bank1   macro
                      00022         bsf     STATUS,RP0
                      00023         bcf     STATUS,RP1
                      00024         endm
                      00025 bank2   macro
                      00026         bcf     STATUS,RP0
                      00027         bsf     STATUS,RP1
                      00028         endm
                      00029 bank3   macro
                      00030         bsf     STATUS,RP0
                      00031         bsf     STATUS,RP1
                      00032         endm
                      00033 let     macro   aa,bb   
                      00034         movlw   bb
                      00035         movwf   aa
                      00036         endm
                      00037 movab macro     aa,bb   
                      00038         movfw   aa
                      00039         movwf   bb
                      00040         endm
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00041 
                      00005         #define first_address 1fffh-.100+.1 ; 100 word in size
                      00006 ;***********************************************************************************
                      00007 IFDEF Debug
                      00008         __config _CP_OFF & _BODEN_ON & _LVP_OFF & _PWRTE_ON & _WDT_OFF & _HS_OSC
                      00009 ENDIF
                      00010 IFNDEF Debug
2007   3F76           00011         __config _CP_OFF & _BODEN_ON & _LVP_OFF & _PWRTE_ON & _WDT_ON & _HS_OSC
                      00012 ENDIF
                      00013 ;************************************************************************************
                      00014 #include Variable.asm           ; Вариант динамического выделения памяти при линковке
                      00001 MB0     udata ;20
                      00002 ;       cblock  20
0000                  00003 AF      RES .1          ; БАЙТ b'10101111'
0001                  00004 BT_CNT  RES .1          ; Счётчик байтов передачи, при передаче всегда 01H
0002                  00005 VERSION RES .1          ; НОМЕР ВЕРСИИ пакета 10H
0003                  00006 SIZE    RES .1          ; Размер пакета
0004                  00007 STAT    RES .1          ; Отображает режим работы (побитовый) 
                      00008                         ;[0]-Motor on [1]-Warm_Up on [2]-IAC [3]-Accel 
                      00009                         ;[4]-D.Accel [5]-ЭПХХ [6]-ЭМР [7] AFTER START ENR
0005                  00010 ERR     RES .1          ; Биты ошибок 
                      00011                         ;Bit:[0]-WDT, [1]-BOR, [2]-T.Inj, [3]-Err.Copm, [4]-COLT,
                      00012                         ;[5]-MAP [6]-O2S [7] - IAT
0006                  00013 STPCNT  RES .1          ; Позиция шагового двигателя
0007                  00014 ColtF   RES .1;5                ; *Показания ДТВ Температура двигателя
0008                  00015 COLT    RES .1;6                ; Показания ДТОЖ
0009                  00016 MAP     RES .1;7                ; Разряжение во впускном коллеторе
000A                  00017 TPS     RES .1;8                ; Положение дроссельной заслонки
000B                  00018 O2S     RES .1;9                ; Показаняи датчика кислорода Lambda=(O2S/2+64)/128
000C                  00019 POWER   RES .1;10               ; Напряжение боротовой сети/10,2
000D                  00020 SPD     RES .1;11               ; Обороты двигателя (SPD*25)
000E                  00021 T_INJ_L RES .1;12
000F                  00022 T_INJ_H RES .1;13               ; Время впрыска(мкс)
                      00023 ;
0010                  00024 INJ_LAG_L       RES .1;14               ; Время срабатывания форсунки
0011                  00025 INJ_LAG_H       RES .1;15
                      00026 
                      00027 
0012                  00028 RqFl    RES .1;16               ; Время впрыска при давлении 110КПа
0013                  00029 RqFh    RES .1;17
0014                  00030 RCOl    RES .1;18               ; 
0015                  00031 RCOh    RES .1;19
0016                  00032 MCKl    RES .1;20               ; Счётчик моточасов
0017                  00033 MCKh    RES .1;21
                      00034 
                      00035 
0018                  00036 WARM_80 RES .1;22               ; Обогащение при прогреве горячего вдигателя (+80)
0019                  00037 WARM_20 RES .1;23               ;+20 Обогащение при прогреве холодного двигателя (-40)
                      00038 
001A                  00039 eSTAT   RES .1          ; Расширенный статус блока
                      00040 
001B                  00041 WARM_40 RES .1;25               ;-40
001C                  00042 WARM_50 RES .1;26               ;+50
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

001D                  00043 D_TPS   RES .1          ; Delta TPS
001E                  00044 ENR_12  RES .1;28               ;-12
                      00045 ;----
001F                  00046 RESERV  RES .2          ; Резерв 2 байта в протоколе
                      00047 ;----
0021                  00048 UOZ     RES .1
0022                  00049 MAN_CORR        RES .1          ; ПЕРЕМЕННАЯ ВЫСТАВЛЯЕМАЯ РУЧНУЮ КОРРЕКТИРОВКУ
0023                  00050 SPD_ENR RES .1;33               ; Корреция смени по скорости
0024                  00051 WARM_ENR        RES .1;34               ; ENRICHMENT
                      00052 ;конец пакета передачи
0025                  00053 CHK_SUM_TX      RES .1          ; Контрольная сумма
                      00054 ;-------------------------------------------------------------------
0026                  00055 CHK_SUM_RX RES .1
                      00056 ;
0027                  00057 STP_CNT_UP RES .1               ; Счётчик регулятора ХХ
0028                  00058 PMPC RES .1                     ; Счётчик выключения ЭБН
0029                  00059 STP_SPEED RES .1
002A                  00060 STP_CNT_DWN RES .1
002B                  00061 TPS1 RES .1
                      00062 ;Mul
002C                  00063 Cnt RES .1
002D                  00064 Temp6 RES .1
002E                  00065 Temp7 RES .1
002F                  00066 Temp8 RES .1
0030                  00067 Temp9 RES .1
0031                  00068 Mul1Lo RES .1
0032                  00069 Mul1Hi RES .1
0033                  00070 ResHi RES .1
                      00071 ;Div
0034                  00072 Cnt2 RES .1
0035                  00073 DivLo RES .1
0036                  00074 DivHi RES .1
0037                  00075 Mul2Lo RES .1
0038                  00076 Mul2Hi RES .1
0039                  00077 Res2Hi RES .1
003A                  00078 Res1 RES .1
003B                  00079 Res2 RES .1
003C                  00080 Res3 RES .1
003D                  00081 Mul2 RES .1
003E                  00082 CntDiv RES .1
003F                  00083 Temp RES .1
0040                  00084 Temp1 RES .1
0041                  00085 Temp2 RES .1
0042                  00086 Temp3 RES .1
0043                  00087 Temp4 RES .1
0044                  00088 Temp5 RES .1
0045                  00089 Flag_Math RES .1        ; 1 - MUL16X8, 0- DIV 24/16, 2- 9bit multp
                      00090 
                      00091 
                      00092 
0046                  00093 MULc RES .1             ; 8 bit multiplicand
0047                  00094 MULp RES .1             ; 8 bit multiplier
0048                  00095 H_byte RES .1           ; High byte of the 16 bit result
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0049                  00096 L_byte RES .1           ; Low byte of the 16 bit result
                      00097 
                      00098 
004A                  00099 BUF_IND RES .1
                      00100 
004B                  00101 RQF2 RES .1
                      00102 
                      00103 
                      00104  
                      00105 ; Размещение данных доступных из всех банков контроллера
                      00106 MB1 UDATA_SHR
                      00107 
                      00108 ;RQF2 RES .1
                      00109 ;FLG_C RES .1
0000                  00110 ADC_SEL RES .1          ; Select chenal ADC
                      00111 
0001                  00112 FLAG RES .1             ; [0] - Разрешение на передачу пакета состояния,
                      00113                 ; [1] - Флаг расчёта оборотов 
                      00114                 ; [2] - расчёт корректировки 
                      00115                 ; [3] - стабилизация оборотво двигателя 
                      00116                 ; [4] - позиционирование РХХ 
                      00117                 ; [5] - выбор канала АЦП
                      00118                 ; [6] - обработка данных с АЦП питания
                      00119                 ; [7] - Расчёт цикловой подачи топлива
0002                  00120 FLAG2 RES .1    ; [0] - Сохраняем время в ЕЕПРОМ
0003                  00121 IAC_INIT RES .1         ; Начальное положение РХХ для запуска двигателя
0004                  00122 TX_DEL_CNT RES .1               ; Счётчик задержки для передачи пакетов
0005                  00123 dil_t RES .1
0006                  00124 dil_t2 RES .1
                      00125 ;TMPI
0007                  00126 TMRL RES .1
0008                  00127 TMRH RES .1
0009                  00128 D_TPS1 RES .1
000A                  00129 TEMP    RES .1  ; временные данные для основного цикла
000B                  00130 temp    RES .1  ; временные данные для прерываний
                      00131 ; Регистры сохранения для прерываний
000C                  00132 STATUS_TEMP RES .1      ; Регистр сохранения регистра статуса
000D                  00133 PCLATH_TEMP RES .1      ; 
000E                  00134 W_TEMP  RES .1
                      00135 
                      00136 
                      00137 MB2 udata 0A0H
00A0                  00138 SPD_BUF_IND res .1 ; не реализован
00A1                  00139 SPD_BUF RES .4
00A5                  00140 PWR_BUF res .4
00A9                  00141 PWR_BUF_IND res .1
00AA                  00142 ADC_POWER       res .1
                      00143 ;Input  RES .1          ; 
                      00144 ;Output         RES .1  ; 
                      00145 ;Index  RES .1  ; 
                      00146 ;SlopeLo        RES .1  ;16 bit
                      00147 ;SlopeHi        RES .1  ; 
                      00148 ;OffsetLo       RES .1;16 bit
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00149 ;OffsetHi       RES .1; 
                      00150 
                      00151 ;INPUTBUF       RES .63
                      00152 ;!!!ВРЕМЕННО ПЕРЕСЕНА!!!
00AB                  00153 RX_DATA RES .1  ; ПРинятый байт
00AC                  00154 TIME_DIV RES .2 ; Делитель минутный
00AE                  00155 MINUTE_CNT RES .1       ; Делитель часовой
00AF                  00156 TEMP_MULT RES .3
                      00015 #include Config.inc             ; Вынесена аппаратная конфигурация
                      00001 ; Порты контроллера
                      00002 ; Порты
                      00003 #define INJ1    PORTB,1 ; Управление форсункой PEACK
                      00004 #define INJ2    PORTB,4 ; Управление форсункой HOLD
                      00005 #define INJ3    PORTB,6
                      00006 #define INJ4    PORTB,7
                      00007 #define INJ5    PORTC,1
                      00008 #define INJ6    PORTC,3
                      00009 #define IGN     PORTC,0
                      00010 #define PUMP    PORTC,4 ; Управление бензонасосом
                      00011 #define EPHH    PORTC,2 ; Эмуляция концевика ХХ
                      00012 #define STEPA   PORTB,2 ; Выход линии А на драйвер ШД
                      00013 #define STEPB   PORTB,3 ; Выход линии Б на драйвер ШД
                      00014 ;#define        ACCEL   PORTC,1 ; Сигнализация мощностного режима
                      00015 #define ACCEL   PORTB,5
                      00016 #define WARM_UP PORTC,3 ; Сигнал режима прогрева
                      00017 #define PIN1    PORTA,4 ; Тумблер РХХ
                      00018 ; Настройка РХХ
                      00019 #define IAC_COLT        D'100'  ; количество шагов на открытие после инициализации для -40 С(80)
                      00020 #define IAC_WARM        D'25'   ; количество шагов на открытие после инициализации для >80 С(20)
                      00021 #define IAC_MAX D'120'  ; количество шагов для максимального закрытия клапана (100)
                      00022 #define WARM_TRSH       D'40'   ; температура включчения прогревочных оборотов
                      00023 #define IAC_MIN D'8'    ; Минимальное положение РХХ
                      00024 #define IAC_TRSH        D'20'   ; Порог быстрого хода РХХ шагов
                      00025 #define IAC_SKIP        .600    ; положение дросселя для начала регулирования ХХ (mV)
                      00026 #define FL_CLEAR        .3027   ; положение дросселя для включения режима продувки (mV)
                      00027 #define SPD_HOT .850    ; Обороты холостого хода (850)
                      00028 #define SPD_WARM        .1250   ; Обороты холостого хода при прогреве (1250)
                      00029 #define SPD_EPHH        .1600   ; Обороты включения экономайзера принудительного холостого хода
                      00030 #define MANSETIAC               ; Включить возможность ручной установки положения РХХ
                      00031 #define MANSETRqF               ; Включить возможность ручной регулировки смеси
                      00032 #define DEMFER  .26     ; Демфер сброса педали акселератора
                      00033 ; Настройка подачи топливной смеси
                      00034 #define ReqFuel .4500   ; Количество топлива при 100кПа(мкс)
                      00035 ;#define        LineIntFuelEqual        ; Линейная интерполяция для расчёта циклового наполнения
                      00036 #define OFFSET  .38     ; Offset MAP sensor (.24 = 0.464 В для линеаризации характеристики ДАД)
                      00037 #define SLOPE   .242    ; Наклон характеристики ДАД, вычисляется давление Pres=(MAP+Offcet)*Slope/256
                      00038 #define ACL_THR 05H     ; Accelerate theshold
                      00039 #define ENR_COEFF       D'1244' ; ЭМР *1000
                      00040 #define ENR_TPS D'1339' ; ОБОГАЩЕНИЕ ПРИ ПОЛНОСТЬЮ ОТКРЫТОМ ДРОССЕЛЕ *1000
                      00041 #define CYL     .4      ; Количество цилиндров у двигателя по соответствии 4т
                      00042 
                      00043 ;Лаг форсунки в зависимости от напряжения(макс 2047мкс)
                      00044 #define LAG086  .1900 ;.1900    
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00045 #define LAG102  .1510;.1600 ;.1510
                      00046 #define LAG118  .1100;.1200 ;.1100
                      00047 #define LAG134  .880;.880  ;.770
                      00048 #define LAG150  .700;.710  ;.610
                      00049 ;Обогащение топлива при прогреве
                      00050 #define WARM_ENR_40     0FFH    ;-40
                      00051 #define WARM_ENR_12     090H    ;-12
                      00052 #define WARM_ENR_20     04BH    ;+20
                      00053 #define WARM_ENR_50     018H    ;+50
                      00054 #define WARM_ENR_80     00H     ;+80
                      00055 ; Пусковые параметры
                      00056 #define PR_PULSE        .5000   ; Время подготовительного импульса впрыска (2мс)
                      00057 #define CRANK_HOT       .3000   ; время впрыска при запуске на горячую (>80)
                      00058 #define CRANK_COLT      .30000  ; время впрыска при запуске на холодную (-40)
                      00059 
                      00060 #define VE_CORR         ; коррекция объёмной характеристики
                      00061 #define WARM_CORR               ; коррекция смеси при прогреве
                      00062 #define ACCEL_CORR              ; обогащение при ускорении
                      00063 #define ECON_CORR               ; Экономайзер мощностных режимов
                      00064 
                      00065 #DEFINE ADC_MAP b'10000001'     ; AN0 Датчик абсолютного давления (MPX4100)
                      00066 #DEFINE ADC_TPS b'10001001'     ; AN1 Датчик положения дроссельной заслонки
                      00067 #DEFINE ADC_COLT        b'10010001'     ; AN2 Датчик температуры ОЖ (LM134)
                      00068 #DEFINE ADC_PWR b'10011001'     ; AN3 Измеритель напряжения бортсети (делитель 4к/1к)
                      00069 #DEFINE ADC_CORR        b'10100001'     ; AN4 Потенциометр качества смеси/датчик кислорода
                      00070 
                      00071 #define SPD_CONST       .2400000/CYL; Констатна для вычисления оборотов двигателя
                      00072 ;#define        SPD_CONST       .600000 ; Констатна для вычисления оборотов двигателя
                      00073 #define hctn    .6000   ; Коррекция минутного счётчика
                      00016 
                      00017 
                      00018 GO_BOOT ORG     0               ; processor reset vector
                      00019 ;       PAGESEL         Bootloader
                      00020 ;       GOTO            Bootloader
                      00021 ;       nop
0000   2???           00022 GO_INIT GOTO    INIT            ; go to beginning of program
                      00023 ;------------------------------------------------------------------
                      00024 ;               ОБРАБОТКА ПРЕРЫВАНИЙ
                      00025 ;{------------------------------------------------------------------
                      00026         ORG     4               ; Вектор прерываний
0004   00??           00027         MOVWF   W_TEMP          ; Копировать W во временный регистр независимо от текущего банка
0005   0E03           00028         SWAPF   STATUS,W                ; Обменять полубайты в регистре STATUS и записать в W           
0006   0183           00029         CLRF    STATUS
0007   00??           00030         MOVWF   STATUS_TEMP             ; Сохранить STATUS во временном регистре банка 0
0008   080A           00031         MOVF    PCLATH, W               ;
0009   00??           00032         MOVWF   PCLATH_TEMP             ;
000A   018A           00033         CLRF    PCLATH          ;
000B   190C           00034         BTFSC   PIR1,CCP1IF             ; Модуль сравнения
000C   2???           00035         GOTO    COMP_EVNT
000D   188B           00036         BTFSC   INTCON,INTF             ; импульс зажигания?
000E   2???           00037         GOTO    SPARK
000F   180C           00038         BTFSC   PIR1,TMR1IF             ; Проверка переполнение таймера ТМР1
0010   2???           00039         GOTO    TMR_OF
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0011   1B0C           00040         BTFSC   PIR1,ADIF               ; Прерывание АЦП
0012   2???           00041         GOTO    Int_AD
0013   190B           00042         BTFSC   INTCON,T0IF             ; Общая синхронизация по ТМР0
0014   2???           00043         GOTO    TMR_EV          
0015   1A8C           00044         BTFSC   PIR1,RCIF       ; Приём байта USART Rx?
0016   2???           00045         GOTO    Int_RX
                      00046 
                      00047 
                      00048 ;------------------------ INT exit-----------------------
0017   08??           00049 RET     MOVF    PCLATH_TEMP, W  ;
0018   008A           00050         MOVWF   PCLATH          ;
0019   0E??           00051         SWAPF   STATUS_TEMP,W   ;Обменять полубайты оригинального значения STATUS и записать в W (восста
                            новить текущий банк)
001A   0083           00052         MOVWF   STATUS          ;Восстановить значение STATUS из регистра W
001B   0E??           00053         SWAPF   W_TEMP,F                ;Обменять полубайты в регистре W_TEMP и сохранить результат в W_
                            TEMP
001C   0E??           00054         SWAPF   W_TEMP,W                ;Обменять полубайты в регистре W_TEMP и восстановить оригинально
                            е значение W без воздействия на STATUS
001D   0009           00055         RETFIE
                      00056 ;}
                      00057 
                      00058 ;------------------------------------------------------------------
                      00059 ;               ИНИЦИАЛИЗАЦИЯ
                      00060 ;{------------------------------------------------------------------
001E   01??           00061  INIT   CLRF    ERR
001F   01??           00062         CLRF    STAT
0020   01??           00063         CLRF    eSTAT
                      00064         bank1
0021   1683               M         bsf     STATUS,RP0
0022   1303               M         bcf     STATUS,RP1
                      00065         let     TRISA,b'00111111'
0023   303F               M         movlw   b'00111111'
0024   0085               M         movwf   TRISA
                      00066         let     TRISB,b'00000001'
0025   3001               M         movlw   b'00000001'
0026   0086               M         movwf   TRISB
                      00067         let     TRISC,b'10000000'
0027   3080               M         movlw   b'10000000'
0028   0087               M         movwf   TRISC
                      00068         let     OPTION_REG,b'11000111'  ; Подтягивающие резисторы включены(Предделитель на tmr0)
0029   30C7               M         movlw   b'11000111'
002A   0081               M         movwf   OPTION_REG
                      00069         let     PIE1,B'01100101'        ; Записать маску прерываний в регистр PIE1
002B   3065               M         movlw   B'01100101'
002C   008C               M         movwf   PIE1
                      00070 ; Настройка УАПП
002D   3067           00071         MOVLW   .103                    ; Установить скорость обмена данными(F=9615 Hz)
002E   0099           00072         MOVWF   SPBRG
002F   3026           00073         MOVLW   B'00100110'     ; Передача 8 - разрядных данных, включить передатчик,
0030   0098           00074         MOVWF   TXSTA           ; ВЫСОКОСКОРОСТНОЙ асинхронный режим
                      00075         let     ADCON1,b'00000010'      ;
0031   3002               M         movlw   b'00000010'
0032   009F               M         movwf   ADCON1
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00076 ; Определение типа сброса контроллера
0033   1C8E           00077         BTFSS   PCON,NOT_POR
0034   2???           00078         GOTO    SETPOR
0035   1C0E           00079         BTFSS   PCON,NOT_BOR    ; BOR - Флаг сброса по снижению напряжения
0036   2???           00080         CALL    ERR_BOR
0037   148E           00081 SETPOR  BSF     PCON,NOT_POR
0038   140E           00082         BSF     PCON,NOT_BOR
                      00083         bank0
0039   1283               M         bcf     STATUS,RP0
003A   1303               M         bcf     STATUS,RP1
                      00084 ; Перед позиционированием РХХ надо измерить температуру ОЖ
                      00085         let     ADCON0,ADC_COLT ;
003B   3091               M         movlw   b'10010001'
003C   009F               M         movwf   ADCON0
003D   0181           00086         CLRF    TMR0
003E   018E           00087         CLRF    TMR1L
003F   018F           00088         CLRF    TMR1H
                      00089 ; Определение типа сброса контроллера
0040   1E03           00090         BTFSS   STATUS,NOT_TO   ; TO - WDT - БИТЫ ИНВЕРСНЫЕ!!!
0041   1400           00091         BSF     ERR,0
0042   0187           00092         CLRF    PORTC
0043   0186           00093         CLRF    PORTB
                      00094         let     T1CON,B'00110000'       ; Инициализация ТМР1, предделитель 1:8 (тик - 2мкс, счёт до 128м
                            с)
0044   3030               M         movlw   B'00110000'
0045   0090               M         movwf   T1CON
0046   0197           00095         CLRF    CCP1CON         ; Инициализация CCP1
0047   3090           00096         MOVLW   B'10010000'     ; Прием 8 - разрядных данных, включить приемник,
0048   0098           00097         MOVWF   RCSTA           ; включить модуль USART 
                      00098 ;------------------------------------------------------------------
                      00099 ;               УСТАНОВКА ПЕРЕМЕННЫХ
                      00100 ;------------------------------------------------------------------   
0049   0064           00101         CLRWDT 
004A   1607           00102         BSF     PUMP            ; Включаем бензонасос
                      00103 
004B   01??           00104         CLRF    BT_CNT
                      00105         let     AF,0AFH         ; Байт заголовка протокола
004C   30AF               M         movlw   0AFH
004D   00??               M         movwf   AF
                      00106         let     VERSION,010H    ; Номер версии протокола
004E   3010               M         movlw   010H
004F   00??               M         movwf   VERSION
                      00107         let     SIZE,.38                ; Размер передаваемого пакета
0050   3026               M         movlw   .38
0051   00??               M         movwf   SIZE
                      00108         let     INJ_LAG_L,low LAG134    ; Время открытия форсунки
0052   3070               M         movlw   low .880
0053   00??               M         movwf   INJ_LAG_L
                      00109         let     INJ_LAG_H,high LAG134   ; Время открытия форсунки
0054   3003               M         movlw   high .880
0055   00??               M         movwf   INJ_LAG_H
                      00110 
                      00111 
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00112         let     RCOh,0H
0056   3000               M         movlw   0H
0057   00??               M         movwf   RCOh
                      00113         let     RCOl,0C0H
0058   30C0               M         movlw   0C0H
0059   00??               M         movwf   RCOl
                      00114         let     RqFh,high ReqFuel
005A   3011               M         movlw   high .4500
005B   00??               M         movwf   RqFh
                      00115         let     RqFl,low ReqFuel
005C   3094               M         movlw   low .4500
005D   00??               M         movwf   RqFl
                      00116         let     WARM_80,WARM_ENR_80
005E   3000               M         movlw   00H
005F   00??               M         movwf   WARM_80
                      00117         let     WARM_50,WARM_ENR_50
0060   3018               M         movlw   018H
0061   00??               M         movwf   WARM_50
                      00118         let     WARM_20,WARM_ENR_20
0062   304B               M         movlw   04BH
0063   00??               M         movwf   WARM_20
                      00119         let     ENR_12,WARM_ENR_12
0064   3090               M         movlw   090H
0065   00??               M         movwf   ENR_12
                      00120         let     WARM_40,WARM_ENR_40
0066   30FF               M         movlw   0FFH
0067   00??               M         movwf   WARM_40
0068   01??           00121         CLRF    ADC_SEL
0069   01??           00122         CLRF    TPS
006A   01??           00123         CLRF    TPS1
006B   01??           00124         CLRF    STP_CNT_DWN
006C   01??           00125         CLRF    STP_CNT_UP
006D   01??           00126         CLRF    CHK_SUM_TX
006E   01??           00127         CLRF    PMPC
006F   01??           00128         CLRF    SPD
0070   01??           00129         CLRF    COLT
                      00130         let     BUF_IND,4
0071   3004               M         movlw   4
0072   00??               M         movwf   BUF_IND
0073   ???? ????      00131         banksel SPD_BUF
0075   01??           00132         CLRF    SPD_BUF
0076   01??           00133         CLRF    SPD_BUF+1
0077   01??           00134         CLRF    SPD_BUF+2
0078   01??           00135         CLRF    SPD_BUF+3
                      00136         let     PWR_BUF_IND,4
0079   3004               M         movlw   4
007A   00??               M         movwf   PWR_BUF_IND
007B   01??           00137         CLRF    PWR_BUF
007C   01??           00138         CLRF    PWR_BUF+1
007D   01??           00139         CLRF    PWR_BUF+2
007E   01??           00140         CLRF    PWR_BUF+3
                      00141         bank0
007F   1283               M         bcf     STATUS,RP0
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0080   1303               M         bcf     STATUS,RP1
0081   01??           00142         CLRF    FLAG
0082   01??           00143         CLRF    FLAG2
0083   ???? ????      00144         BANKSEL TIME_DIV
                      00145         let     TIME_DIV,.1
0085   3001               M         movlw   .1
0086   00??               M         movwf   TIME_DIV
                      00146         let     TIME_DIV+1,.1
0087   3001               M         movlw   .1
0088   00??               M         movwf   TIME_DIV+1
                      00147         bank0
0089   1283               M         bcf     STATUS,RP0
008A   1303               M         bcf     STATUS,RP1
                      00148 
                      00149         let     T_INJ_H, high PR_PULSE
008B   3013               M         movlw   high .5000
008C   00??               M         movwf   T_INJ_H
                      00150         let     T_INJ_L, low PR_PULSE
008D   3088               M         movlw   low .5000
008E   00??               M         movwf   T_INJ_L
008F   2???           00151         CALL    DELEY20
0090   151F           00152         BSF     ADCON0,GO
0091   191F           00153 WTGO1   BTFSC   ADCON0,GO
                      00154 ;       CLRWDT
0092   2???           00155         GOTO    WTGO1
0093   2???           00156         CALL    GET_COLT
0094   130C           00157         BCF     PIR1,ADIF
0095   1780           00158         BSF     STAT,7
                      00159         let     INTCON,B'11110000'      ; ГЛОБАЛЬНЕО РАЗРЕШЕНИЕ ПРЕРЫВАНИЙ
0096   30F0               M         movlw   B'11110000'
0097   008B               M         movwf   INTCON
0098   2???           00160         CALL    STPINIT         ; Сброс позиции ШАГОВОГО ДВИГАТЕЛЯ
                      00161 ;       BSF     INTCON,GIE
                      00162 IFDEF PR_PULSE
0099   148B           00163         BSF     INTCON,INTF             ; Подготовительный впрыск
                      00164 ENDIF
009A   2???           00165         GOTO    MAIN
                      00166 ;}
                      00167 ;------------------------------------------------------------------
                      00168 ;               ОНОВНОЙ ЦИКЛ ПРОГРАММЫ
                      00169 ;{------------------------------------------------------------------
009B   0064           00170 MAIN    CLRWDT
                      00171         bank0
009C   1283               M         bcf     STATUS,RP0
009D   1303               M         bcf     STATUS,RP1
                      00172 #IFDEF Debug
                      00173         BTFSC   PIN1
                      00174         BSF     ERR,7
                      00175         BTFSS   PIN1
                      00176         BCF     ERR,7           
                      00177 #ENDIF
                      00178 
                      00179 
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

009E   1C00           00180         BTFSS   FLAG,0          ; ПЕРЕДАЧА АКТИВНА?
009F   2???           00181         GOTO    NEXT
                      00182         
                      00183         bank1 
00A0   1683               M         bsf     STATUS,RP0
00A1   1303               M         bcf     STATUS,RP1
00A2   1C98           00184         BTFSS   TXSTA,TRMT              ; ПЕРЕДАЧА 
00A3   2???           00185         GOTO    NX              ; ДАННЫХ
                      00186         bank0
00A4   1283               M         bcf     STATUS,RP0
00A5   1303               M         bcf     STATUS,RP1
00A6   2???           00187         CALL    TX
                      00188 NX      bank0
00A7   1283               M         bcf     STATUS,RP0
00A8   1303               M         bcf     STATUS,RP1
00A9   2???           00189         GOTO    NX2
                      00190 
00AA   1898           00191 NEXT    BTFSC   TXSTA,TRMT              ; После завершения передачи И опустошения буфера передачи
00AB   1618           00192         BSF     RCSTA,CREN              ; Включаем приёмник
                      00193 
00AC   1B80           00194 NX2     BTFSC   FLAG,7          ; Расчёт цикловой подачи
00AD   2???           00195         CALL    M_CALC
00AE   1880           00196         BTFSC   FLAG,1          ; Флаг расчёта оборотов двигателя
00AF   2???           00197         GOTO    M_SPD
00B0   1980           00198         BTFSC   FLAG,3          ; Стабилизация оборотов двигателя
00B1   2???           00199         CALL    STAB
00B2   1A80           00200         BTFSC   FLAG,5
00B3   2???           00201         CALL    ADC_SELECT
00B4   1900           00202         BTFSC   FLAG,2          ; Расчёт корректировки смеси
00B5   2???           00203         GOTO    CORR
00B6   1800           00204         BTFSC   FLAG2,0         ; Счётчик моточасов
00B7   2???           00205         CALL    WRT_CNTR
00B8   1B00           00206         BTFSC   FLAG,6
00B9   2???           00207         CALL    LAG             ; Вычисляем лаг форсунки
00BA   1C98           00208         BTFSS   RCSTA,OERR              ;Ошибка переполнения внутреннего буфера, устанавливаетсяв ‘0’ пр
                            и сбросе бита CREN
00BB   2???           00209         GOTO    MAIN
00BC   1218           00210         BCF     RCSTA,CREN      
00BD   1618           00211         BSF     RCSTA,CREN
00BE   2???           00212         GOTO    MAIN
                      00213 ;-----------------------------------------------------
                      00214 ;       ПЕРЕДАЧА ДАННЫХ
                      00215 ;-----------------------------------------------------
00BF   08??           00216 TX      MOVF    BT_CNT,W                ; КОЛИЧЕСТВО БАЙТ В ПАКЕТЕ +1
00C0   02??           00217         SUBWF   SIZE,W          ;
00C1   1903           00218         BTFSC   STATUS,Z                ; ПРОВЕРЯЕМ НА ПЕРЕПОЛНЕНИЕ
00C2   2???           00219         GOTO    CLR_TX          ; ОБНУЛЕНИЕ СЧЁТЧИКА И КОНТРОЛЬНОЙ СУММЫ
00C3   1C03           00220         BTFSS   STATUS,C                ; ПРОВЕРЯЕМ НА ПЕРЕПОЛНЕНИЕ
00C4   2???           00221         GOTO    CLR_TX          ; ОБНУЛЕНИЕ СЧЁТЧИКА И КОНТРОЛЬНОЙ СУММЫ
                      00222         movab   BT_CNT,FSR              ; ЗАГРУЖАЕМ СЧЁТЧИК БАЙТ В РЕГИСТР КОСВЕННОЙ АДРЕСАЦИИ  
00C5   08??               M         movfw   BT_CNT
00C6   0084               M         movwf   FSR
00C7   3020           00223         MOVLW   20H             ; Добавляем начало блока переменных
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00C8   0784           00224         ADDWF   FSR,F           ; Приращаем FSR на начальное значение
00C9   0800           00225         Movfw   INDF            ; Читаем байт с памяти  
00CA   07??           00226         ADDWF   CHK_SUM_TX,F            ; ДОБАВЛЯЕМ БАЙТ ДЛЯ РАСЧЁТА КОНТРОЛЬНОЙ СУММЫ
00CB   0099           00227         MOVWF   TXREG
                      00228 ;       bank1 
                      00229 ;       BTFSS           TXSTA,TRMT              ; ПЕРЕДАЧА 
                      00230 ;       GOTO             $-1            ; ДАННЫХ
                      00231 ;       bank0
00CC   0A??           00232         INCF    BT_CNT,F
00CD   0008           00233         RETURN
00CE                  00234 WRT_CNTR
00CE   1000           00235         BCF     FLAG2,0
00CF   0008           00236         RETURN
                      00237 ;-----------------------------------------------------
                      00238 ;       Расчёт корректировок
                      00239 ;-----------------------------------------------------
00D0   1100           00240 CORR    BCF     FLAG,2
                      00241 IFDEF MANSETRqF
00D1   1A05           00242         BTFSC   PIN1
00D2   2???           00243         GOTO    CORR_RCO
                      00244         let     RqFh,high (ReqFuel-.3000)
00D3   3005               M         movlw   high (.4500-.3000)
00D4   00??               M         movwf   RqFh
                      00245         let     RqFl,low (ReqFuel-.3000)
00D5   30DC               M         movlw   low (.4500-.3000)
00D6   00??               M         movwf   RqFl
00D7   0E??           00246         SWAPF   MAN_CORR,W
00D8   39F0           00247         ANDLW   0F0H            ; Старший полубайт
00D9   07??           00248         ADDWF   RqFl,F          ; в младший регистр
00DA   1803           00249         BTFSC   STATUS,C
00DB   0A??           00250         INCF    RqFh,F  
00DC   0E??           00251         SWAPF   MAN_CORR,W              ; Загрузка значения времени ВПРЫСКА
00DD   390F           00252         ANDLW   0FH             ; Младший полубайт
00DE   07??           00253         ADDWF   RqFh,F          ; в старший регистр
                      00254 endif   
                      00255 
00DF                  00256 CORR_RCO
                      00257 ;       BCF     STATUS,C
                      00258 ;       RRF     MAN_CORR,F
                      00259 ;
                      00260 ;       let     RCOh,0H
                      00261 ;       let     RCOl,0C0H
                      00262 ;       SWAPF   MAN_CORR,W              ; Загрузка значения времени ВПРЫСКА
                      00263 ;       ANDLW   0FH             ; Младший полубайт
                      00264 ;       ADDWF   RCOh,F          ; в старший регистр
                      00265 ;       SWAPF   MAN_CORR,W
                      00266 ;       ANDLW   0F0H            ; Старший полубайт
                      00267 ;       MOVWF   RCOl            ; в младший регистр
                      00268 
00DF                  00269 CORR_LAG;       CALL    LAG             ; Вычисляем лаг форсунки
00DF   2???           00270         GOTO    MAIN
                      00271 
                      00272 
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00273 
                      00274 ;-----------------------------------------------------
                      00275 ;       ВЫЧИСЛЕНИЕ ОБОРОТОВ ДВИГАТЕЛЯ
                      00276 ;-----------------------------------------------------
00E0   1080           00277 M_SPD   BCF     FLAG,1
                      00278         let     Mul2Lo,low SPD_CONST; 0C0H
00E1   3000               M         movlw   low .2400000/.4
00E2   00??               M         movwf   Mul2Lo
                      00279         let     Mul2Hi,high SPD_CONST;027H
00E3   3027               M         movlw   high .2400000/.4
00E4   00??               M         movwf   Mul2Hi
                      00280         let     Res2Hi,upper SPD_CONST;09H
00E5   3009               M         movlw   upper .2400000/.4
00E6   00??               M         movwf   Res2Hi
00E7   120B           00281         BCF     INTCON,INTE ;Блокировка прерывания для защиты целостности переменной
00E8   08??           00282         MOVF    TMRL,W
00E9   00??           00283         MOVWF   DivLo
00EA   08??           00284         MOVF    TMRH,W
00EB   00??           00285         MOVWF   DivHi
00EC   160B           00286         BSF     INTCON,INTE
                      00287 ; Проверка на минимальные обороты
00ED   08??           00288         MOVF    DivLo,F
00EE   1D03           00289         BTFSS   STATUS,Z        
00EF   2???           00290         GOTO    $+4
00F0   08??           00291         MOVF    DivHi,F
00F1   1903           00292         BTFSC   STATUS,Z
00F2   2???           00293         GOTO    SPD_NULL
00F3   2???           00294         CALL    Div24_16        ; Вычисляем обороты двигателя
00F4   08??           00295         MOVF    Mul2Hi,W        ; Проверка на превышение оборотов
00F5   1903           00296         BTFSC   STATUS,Z
00F6   2???           00297         GOTO    SPD_INTPL
00F7   30FF           00298         MOVLW   0FFH    ; Максимальные обороты доступные в данной системе счисления
00F8   00??           00299         MOVWF   Mul2Lo
                      00300 
                      00301 
                      00302 ;Сюда в пишем алгоритм усреднения оборотов
00F9   30??           00303 SPD_INTPL       MOVLW   SPD_BUF-1       ; Указатель кольцевого буфера
00FA   07??           00304         ADDWF   BUF_IND,W
00FB   0084           00305         MOVWF   FSR
00FC   08??           00306         Movfw   Mul2Lo          ; ЗАГРУЖАЕМ ВЫЧИСЛЕННУЮ СКОРОСТЬ
00FD   0080           00307         MOVWF   INDF            ; В ЯЧЕЙКУ КОЛЬЦЕВОГО БУФЕРА
00FE   0B??           00308         decfsz  BUF_IND,F
00FF   2???           00309         GOTO    $+3
0100   3004           00310         MOVLW   .4
0101   00??           00311         MOVWF   BUF_IND
                      00312 
                      00313 ; Вычисляем скользящее среднее
0102   01??           00314         CLRF    TEMP
0103   ???? ????      00315         banksel SPD_BUF
0105   08??           00316         Movfw   SPD_BUF
0106   07??           00317         ADDWF   SPD_BUF+1,W
0107   1803           00318         BTFSC   STATUS,C
0108   0A??           00319         INCF    TEMP,F
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00320 
0109   07??           00321         ADDWF   SPD_BUF+2,W
010A   1803           00322         BTFSC   STATUS,C
010B   0A??           00323         INCF    TEMP,F
                      00324 
010C   07??           00325         ADDWF   SPD_BUF+3,W
010D   1803           00326         BTFSC   STATUS,C
010E   0A??           00327         INCF    TEMP,F
                      00328         bank0
010F   1283               M         bcf     STATUS,RP0
0110   1303               M         bcf     STATUS,RP1
0111   00??           00329         MOVWF   SPD
0112   0C??           00330         RRF     TEMP,F
0113   0C??           00331         RRF     SPD,F
0114   0C??           00332         RRF     TEMP,F
0115   0C??           00333         RRF     SPD,F
                      00334 ; определяем остановлен/запущен двигатель
0116   08??           00335         Movf    SPD,W   
0117   3C10           00336         SUBLW   D'16'           ; 400/25 обороты порога
0118   1D03           00337         BTFSS   STATUS,Z
0119   1C03           00338         BTFSS   STATUS,C
011A   2???           00339         GOTO    MTR_ON
011B   1000           00340         BCF     STAT,0          ; Двигатель остановлен
011C   2???           00341         GOTO    MTR_OFF
011D   1400           00342 MTR_ON  BSF     STAT,0          ; Двигатель запущен
011E   2???           00343         GOTO    MAIN
011F   01??           00344 SPD_NULL        CLRF    SPD
0120   1780           00345 MTR_OFF BSF     STAT,7          ; Включаем обогащение при старте        
0121   1000           00346         BCF     STAT,0
0122   2???           00347         GOTO    MAIN
                      00348 ;}
                      00349 ;-----------------------------------------------------
                      00350 ;       ОБРАБОТКА ИМПУЛЬСОВ ЗАЖИГАНИЯ
                      00351 ;{-----------------------------------------------------
0123   1010           00352 SPARK   BCF     T1CON,TMR1ON    ;выключаем таймер
0124   108B           00353         BCF     INTCON,INTF     ;сброс флага прерывания  
0125   080E           00354         MOVF    TMR1L,W
0126   00??           00355         MOVWF   TMRL
0127   080F           00356         MOVF    TMR1H,W
0128   00??           00357         MOVWF   TMRH            ;запоминаем значение таймера
                      00358 
0129   018E           00359         CLRF    TMR1L
012A   018F           00360         CLRF    TMR1H
012B   1410           00361         BSF     T1CON,TMR1ON            ; Включаем таймер
012C   130C           00362         BCF     PIR1,ADIF               ; СБРОС ПРЕРЫВАНИЯ ADC
                      00363         let     ADCON0,ADC_MAP          ; Выбор канала MAP Sensor
012D   3081               M         movlw   b'10000001'
012E   009F               M         movwf   ADCON0
012F   1A06           00364         BTFSC   INJ2            ; проверяем на завершение предыдушего цикла впрыска
0130   1500           00365         BSF     ERR,2           ; Установка флага ограничения времени впрыска
0131   1486           00366         BSF     INJ1            ; Включаем форсунку
0132   1480           00367         BSF     FLAG,1
0133   01??           00368         CLRF    PMPC
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00369 
                      00370         ; Загрузка значения времени открытия форсунки
0134   1003           00371         BCF     STATUS,C
0135   0C??           00372         RRF     INJ_LAG_H,W             ; старший 
0136   3903           00373         ANDLW   03h             ; Защита от превышения лага, макс 2047мкс
0137   0096           00374         MOVWF   CCPR1H          ; в старший регистр
                      00375 
0138   0C??           00376         RRF     INJ_LAG_L,W
0139   0095           00377         MOVWF   CCPR1L          ; в младший регистр
                      00378 
013A   1C00           00379         BTFSS   STAT,0          ; При пуске увеличиваем время открытия
013B   0A96           00380         INCF    CCPR1H,F                ; форсунки на 512мкс
                      00381         let     CCP1CON,B'00001010'     ; Запускаем CCP1
013C   300A               M         movlw   B'00001010'
013D   0097               M         movwf   CCP1CON
013E   1606           00382         BSF     INJ2
013F   1780           00383         BSF     FLAG,7
0140   0000           00384         NOP
0141   0000           00385         NOP
0142   0000           00386         NOP
0143   0000           00387         NOP
0144   0000           00388         NOP
0145   0000           00389         NOP
0146   1607           00390         BSF     PUMP
0147   151F           00391         BSF     ADCON0,GO
0148   1A80           00392         BTFSC   STAT,5          ; Проверка ЭПХХ
0149   2???           00393         GOTO    INJ_CLS         ; Переход на закрытие фосрунки
014A   2???           00394         GOTO    RET
                      00395 ;}
                      00396 
                      00397 
                      00398 ;-----------------------------------------------------
                      00399 ;       ОБРАБОТКА СОБЫТИЙ МОДУЛЯ СРАВНЕНИЯ
                      00400 ;{-----------------------------------------------------
014B   110C           00401 COMP_EVNT       BCF     PIR1,CCP1IF             ; Сбрасываем флаг сравнения
014C   0197           00402         CLRF    CCP1CON         ; Остановить сравнение
014D   1A80           00403         BTFSC   STAT,5          ; Проверка ЭПХХ
014E   2???           00404         GOTO    INJ_CLS         ; Переход на закрытие фосрунки
014F   1886           00405         BTFSC   INJ1            ; ПРоверка режима PEAK
0150   2???           00406         GOTO    INJ_HOLD
0151   1A06           00407         BTFSC   INJ2            ; Проверка на завершение впрыска
0152   2???           00408         GOTO    INJ_CLS         ; Вызов подпрограммы выключения форсунки
0153   1580           00409         BSF     ERR,3           ; Установить бит ошибки обработки события сравнения     
0154   2???           00410         GOTO    RET
                      00411 
0155   1086           00412 INJ_HOLD        BCF     INJ1            ; Выключаем ключ прямой подачи напряжения
0156   08??           00413         MOVF    T_INJ_H,W
0157   1D03           00414         BTFSS   STATUS,Z
0158   2???           00415         GOTO    INJ_LOAD
0159   300F           00416         MOVLW   0FH
015A   02??           00417         SUBWF   T_INJ_L,W
015B   1C03           00418         BTFSS   STATUS,C
015C   2???           00419         GOTO    INJ_CLS
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00420 
015D   0C??           00421 INJ_LOAD        RRF     T_INJ_H,W               ; Обмен полубайтами
015E   0C??           00422         RRF     T_INJ_L,W
015F   0795           00423         ADDWF   CCPR1L,F
                      00424 
0160   1803           00425         BTFSC   STATUS,C                ; проверяем CARRY
0161   0A96           00426         INCF    CCPR1H,F
                      00427 
0162   1003           00428         BCF     STATUS,C
0163   0C??           00429         RRF     T_INJ_H,W
0164   397F           00430         ANDLW   07FH
0165   0796           00431         ADDWF   CCPR1H,F                ; суммируем со значением
                      00432         let     CCP1CON,B'00001010'     ; Запускаем CCP1
0166   300A               M         movlw   B'00001010'
0167   0097               M         movwf   CCP1CON
                      00433 
                      00434 ;       let     ADCON0,ADC_TPS
                      00435 ;       let     ADC_SEL,.4
                      00436 ;       CALL    DELEY20
                      00437 ;       BSF     ADCON0,GO
0168   2???           00438         GOTO    RET
                      00439 
                      00440 ;}
                      00441 
                      00442 
                      00443 
                      00444 
                      00445 ;------------------------------------------------------------------
                      00446 ; Подпрограмма обработки событий переполнения таймера TMR1
                      00447 ;{----------------------------------------------------------------
0169   1010           00448 TMR_OF  BCF     T1CON,TMR1ON    ; Останавливаем таймер
016A   100C           00449         BCF     PIR1,TMR1IF             ; Сбрасываем флаг прерывания
016B   1080           00450         BCF     FLAG,1          ; Сброс флага расчёта оборотов
016C   018F           00451         CLRF    TMR1H
016D   018E           00452         CLRF    TMR1L   
016E   1600           00453         BSF     FLAG,4          ; ВЫСТАВИМ РХХ НА ПУСКОВОЕ ЗНАЧЕНИЕ
016F   01??           00454         CLRF    SPD             ; ОБОРОТЫ РАВНЫ 0
0170   1000           00455         BCF     STAT,0          ;
0171   1780           00456         BSF     STAT,7          ;
0172   0197           00457 INJ_CLS CLRF    CCP1CON         ; Остановить сравнение
0173   1206           00458         BCF     INJ2            ; Выключаем подачу напряжения на форсунки
0174   0000           00459         NOP
0175   0000           00460         NOP
0176   0000           00461         NOP
0177   0000           00462         NOP
0178   0000           00463         NOP
0179   1086           00464         BCF     INJ1            ; Впрыск закончился
017A   2???           00465         GOTO    RET
                      00466 
                      00467 ;}
                      00468 
                      00469 ;-----------------------------------------------------
                      00470 ;       ОБРАБОТКА СОБЫТИЙ ТАЙМРА TMR0
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00471 ;{-----------------------------------------------------
017B   110B           00472 TMR_EV  BCF     INTCON,T0IF             ; Сброс флага прерывания
                      00473         let     TMR0,.255-.156  ; Счёт таймера 10мс(100Гц)
017C   3063               M         movlw   .255-.156
017D   0081               M         movwf   TMR0
017E   0F??           00474         INCFSZ  PMPC,F          ; Инкремент счётчика бензонасоса
017F   2???           00475         GOTO    TMRM2           ;
0180   1207           00476         BCF     PUMP            ; Выключаем бензонасос
                      00477 
0181   0B??           00478 TMRM2   DECFSZ  TX_DEL_CNT,F
0182   2???           00479         GOTO    TMRM3
                      00480         let     TX_DEL_CNT,.10  ; ИНТЕРВАЛ МЕЖДУ ПАКЕТАМИ
0183   300A               M         movlw   .10
0184   00??               M         movwf   TX_DEL_CNT
                      00481 ; ДОПИСАТЬ ПРОВЕРКУ НА ТЕКУЩИЙ ПРИЁМ ДАННЫХ И ПРОВЕРКУ НА ОГРАНИЧЕНИЕ ПО ВРЕМЕНИ!!!!!!!
0185   1218           00482         BCF     RCSTA,CREN              ; Останавливаем приёмник
0186   1400           00483         BSF     FLAG,0          ; Бит инициализации передачи пакета
0187                  00484 TMRM3
                      00485 ; ДОБАВКА Устанавливаем флаг обработки стабилизации оборотов двигателя
0187   1C00           00486 TMR_EX  BTFSS   STAT,0
0188   1580           00487         BSF     FLAG,3  
0189   1980           00488         BTFSC   Flag_Math,3
018A   2???           00489         GOTO    $+4
018B   1580           00490         BSF     FLAG,3  ; СТАБИЛИЗАЦИЯ ОБОРОТОВ И ДРУГИЕ РАСЧЁТЫ
018C   1580           00491         BSF     Flag_Math,3
018D   2???           00492         GOTO    $+2
018E   1180           00493         BCF     Flag_Math,3     
018F   1680           00494         BSF     FLAG,5
                      00495         
                      00496         
                      00497 
                      00498 ; Счётчик моточасов
0190   ???? ????      00499         banksel TIME_DIV
0192   0B??           00500         DECFSZ  TIME_DIV,F
0193   2???           00501         GOTO    TMROUT
0194   08??           00502         TSTF    TIME_DIV+1
0195   1903 2???      00503         BZ      HCNSET
0197   0B??           00504         DECFSZ  TIME_DIV+1,F
0198   2???           00505         GOTO    TMROUT
                      00506 HCNSET  let     TIME_DIV+1,high hctn
0199   3017               M         movlw   high .6000
019A   00??               M         movwf   TIME_DIV+1
                      00507         let     TIME_DIV,low hctn
019B   3070               M         movlw   low .6000
019C   00??               M         movwf   TIME_DIV
019D   1400           00508         BSF     FLAG2,0
019E   0B??           00509         DECFSZ  MINUTE_CNT,F
019F   2???           00510         GOTO    TMROUT
                      00511         let     MINUTE_CNT,.60
01A0   303C               M         movlw   .60
01A1   00??               M         movwf   MINUTE_CNT
                      00512         bank0
01A2   1283               M         bcf     STATUS,RP0
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01A3   1303               M         bcf     STATUS,RP1
01A4   0F??           00513         INCFSZ  MCKl,F
01A5   2???           00514         GOTO    TMROUT
01A6   0A??           00515         INCF    MCKh,F
                      00516 TMROUT  bank0
01A7   1283               M         bcf     STATUS,RP0
01A8   1303               M         bcf     STATUS,RP1
01A9   2???           00517         GOTO    RET
                      00518 ;}
                      00519 ;-----------------------------------------------------
                      00520 ;        ПОДПРОГРАММА ВЫБОРА КАНАЛА  АЦП
                      00521 ;{-----------------------------------------------------
01AA   191F           00522 ADC_SELECT      BTFSC   ADCON0,GO
01AB   0008           00523         RETURN  
01AC   130C           00524         BCF     PIR1,ADIF               ; СБРОС ПРЕРЫВАНИЯ
01AD   1280           00525         BCF     FLAG,5
01AE   0B??           00526         DECFSZ  ADC_SEL,F
01AF   2???           00527         GOTO    ADC1
                      00528         let     ADC_SEL,.5
01B0   3005               M         movlw   .5
01B1   00??               M         movwf   ADC_SEL
01B2   08??           00529 ADC1    MOVF    ADC_SEL,W
01B3   3A01           00530         XORLW   01H             ; Correction
01B4   1D03           00531         BTFSS   STATUS,Z
01B5   2???           00532         GOTO    ADC2
                      00533         let     ADCON0,ADC_CORR
01B6   30A1               M         movlw   b'10100001'
01B7   009F               M         movwf   ADCON0
01B8   2???           00534         GOTO    SEL
                      00535 
01B9   08??           00536 ADC2    MOVF    ADC_SEL,W
01BA   3A02           00537         XORLW   02H             ; PWR
01BB   1D03           00538         BTFSS   STATUS,Z
01BC   2???           00539         GOTO    ADC3
                      00540         let     ADCON0,ADC_PWR
01BD   3099               M         movlw   b'10011001'
01BE   009F               M         movwf   ADCON0
01BF   2???           00541         GOTO    SEL
                      00542 
01C0   08??           00543 ADC3    MOVF    ADC_SEL,W
01C1   3A03           00544         XORLW   03H             ; COLT
01C2   1D03           00545         BTFSS   STATUS,Z
01C3   2???           00546         GOTO    ADC4
                      00547         let     ADCON0,ADC_COLT
01C4   3091               M         movlw   b'10010001'
01C5   009F               M         movwf   ADCON0
01C6   2???           00548         GOTO    SEL
                      00549 
01C7   1800           00550 ADC4    BTFSC   STAT,0
01C8   0008           00551         RETURN
                      00552 
01C9   08??           00553         MOVF    ADC_SEL,W
01CA   3A04           00554         XORLW   04H             ; MAP
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01CB   1D03           00555         BTFSS   STATUS,Z
01CC   2???           00556         GOTO    ADC5
                      00557         let     ADCON0,ADC_MAP
01CD   3081               M         movlw   b'10000001'
01CE   009F               M         movwf   ADCON0
01CF   2???           00558         GOTO    SEL
                      00559 
01D0   08??           00560 ADC5    MOVF    ADC_SEL,W
01D1   3A05           00561         XORLW   05H             ; TPS
01D2   1D03           00562         BTFSS   STATUS,Z
01D3   2???           00563         GOTO    SEL
                      00564 SET_ADC_TPS     let     ADCON0,ADC_TPS
01D4   3089               M         movlw   b'10001001'
01D5   009F               M         movwf   ADCON0
01D6   2???           00565         GOTO    SEL
                      00566 
01D7                  00567 SEL
                      00568 ;Необходимо 20мкс задержки после выбора канала перед запуском преобразования
01D7   2???           00569         CALL    DELEY20
01D8   151F           00570         BSF     ADCON0,GO
01D9   0008           00571         RETURN
                      00572 ;}
                      00573 
                      00574 
                      00575         
                      00576 ;-------------------------------------------------------
                      00577 ;       Модули задержки и прочие модули
                      00578 ;{ Подпрограмма вырабатывания задержки(6.4мс)
                      00579 DELAY   let     dil_t2,d'20'
01DA   3014               M         movlw   d'20'
01DB   00??               M         movwf   dil_t2
01DC   0064           00580         CLRWDT
01DD   2???           00581 DEL1    CALL    DEL
01DE   0064           00582         CLRWDT
01DF   0B??           00583         DECFSZ  dil_t2,f
01E0   2???           00584         GOTO    DEL1
01E1   0008           00585         RETURN
                      00586 ; Задержка для вырабатывания длительности импульса(318мкс)
                      00587 DEL     let     dil_t,d'255'
01E2   30FF               M         movlw   d'255'
01E3   00??               M         movwf   dil_t
01E4   0B??           00588 dilt    DECFSZ  dil_t,f
01E5   2???           00589         GOTO    dilt
01E6   0008           00590         RETURN
                      00591 DELEY20 let     dil_t,d'25'
01E7   3019               M         movlw   d'25'
01E8   00??               M         movwf   dil_t
01E9   2???           00592         GOTO    dilt
                      00593 
                      00594 ; ПОДПРОГРАММА УСТАНОВКИ БИТА СБРОСА ПО СНИЖЕНИЮ ПИТАНИЯ
                      00595 ERR_BOR bank0
01EA   1283               M         bcf     STATUS,RP0
01EB   1303               M         bcf     STATUS,RP1
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01EC   1480           00596         BSF     ERR,1
                      00597         bank1
01ED   1683               M         bsf     STATUS,RP0
01EE   1303               M         bcf     STATUS,RP1
01EF   0008           00598         RETURN
                      00599 ; ПОДПРОГРАММА ОБНУЛЕНИЯ СЧЁТЧИКА БАЙТ ПЕРЕДАЧИ И КОНТРОЛЬНОЙ СУММЫ
                      00600 CLR_TX  bank0
01F0   1283               M         bcf     STATUS,RP0
01F1   1303               M         bcf     STATUS,RP1
01F2   01??           00601         CLRF    BT_CNT          ; ОБНУЛЕНИЕ СЧЁТЧИКА
01F3   01??           00602         CLRF    CHK_SUM_TX
01F4   1000           00603         BCF     FLAG,0          ; Пакет закончен-передача остановлена
01F5   0008           00604         RETURN
                      00605         
01F6   30??           00606 READ_STR        MOVLW   HIGH EngSC
01F7   008A           00607         MOVWF   PCLATH
01F8   08??           00608         MOVF    TEMP,W          ; Чтение таблицы DT основной цикл
01F9   0082           00609         MOVWF   PCL 
01FA   30??           00610 READ_STR2       MOVLW   HIGH Lamb
01FB   008A           00611         MOVWF   PCLATH
01FC   08??           00612         MOVF    temp,W          ; Чтение таблицы DT в прерываниях
01FD   0082           00613         MOVWF   PCL 
                      00614 
                      00615 
                      00616         ;}
                      00617 ;-----------------------------------------------------
                      00618 ; ПОДПРОГРАММА ОБРАБОТКИ ПРЕРЫВАНИЙ АЦП
                      00619 ;{-----------------------------------------------------
01FE   130C           00620 Int_AD  BCF     PIR1,ADIF               ; СБРОС ПРЕРЫВАНИЯ
01FF   191F           00621         BTFSC   ADCON0,GO
0200   2???           00622         GOTO    RET
                      00623 
0201   081F           00624         MOVF    ADCON0,W
0202   3A91           00625         XORLW   ADC_COLT
0203   1D03           00626         BTFSS   STATUS,Z                ; ДТОЖ?
0204   2???           00627         GOTO    ADC01
0205   2???           00628         CALL    GET_COLT
0206   2???           00629         GOTO    RET
                      00630 
0207   081F           00631 ADC01   MOVF    ADCON0,W
0208   3A89           00632         XORLW   ADC_TPS
0209   1D03           00633         BTFSS   STATUS,Z
020A   2???           00634         GOTO    GET_DAD
020B   08??           00635         MOVF    TPS,W           ; СОХРАНЯЕМ ЗНАЧЕНИЕ ДПДЗ
020C   00??           00636         MOVWF   TPS1
020D   081E           00637         MOVF    ADRESH,W
020E   00??           00638         MOVWF   TPS             ; Записываем положение ДЗ       
                      00639 
                      00640 
020F   3C1E           00641         SUBLW   IAC_SKIP*.255/.5000     ; Порог стабилизации холостого хода
0210   1C03           00642         BTFSS   STATUS,C                ; Если положение ДЗ меньше порога
0211   2???           00643         GOTO    CLR_IAC         ; То переходим на след, метку
0212   1500           00644         BSF     STAT,2          ; Ставим флаг холостого хода
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0213   1507           00645         BSF     EPHH            ; Включаем эмуляцию концевика ХХ
0214   2???           00646         GOTO    RET
0215   1100           00647 CLR_IAC BCF     STAT,2          ; Выключаем флаг ХХ
0216   1107           00648         BCF     EPHH
0217   2???           00649         GOTO    RET
                      00650 
                      00651 
                      00652 
0218   081F           00653 GET_DAD MOVF    ADCON0,W                ; ДАД
0219   3A81           00654         XORLW   ADC_MAP
021A   1D03           00655         BTFSS   STATUS,Z
021B   2???           00656         GOTO    ADC02
021C   081E           00657         MOVF    ADRESH,W
021D   00??           00658         MOVWF   MAP
                      00659 ; Проверка верхней границы
021E   3E0F           00660         ADDLW   0FH             ; ДАД
021F   1C03           00661         BTFSS   STATUS,C
0220   2???           00662         GOTO    $+2
0221   1680           00663         BSF     ERR,5           ; Выставить флаг ошибки
0222   3005           00664         MOVLW   05H             ; ПРоверка нижней границы
0223   02??           00665         SUBWF   MAP,W
0224   1803           00666         BTFSC   STATUS,C
0225   2???           00667         GOTO    RET
0226   1D00           00668         BTFSS   STAT,2
0227   1680           00669         BSF     ERR,5           ; Выставить флаг ошибки
0228   2???           00670         GOTO    RET
                      00671 
0229   081F           00672 ADC02   MOVF    ADCON0,W                ; Напряжение бортсети
022A   3A99           00673         XORLW   ADC_PWR
022B   1D03           00674         BTFSS   STATUS,Z
022C   2???           00675         GOTO    ADC03
022D   081E           00676         MOVF    ADRESH,W
022E   1C00           00677         BTFSS   STAT,0          ; если мотор запущен -то пропускаем
022F   00??           00678         MOVWF   POWER
0230   ???? ????      00679         banksel ADC_POWER
0232   00??           00680         MOVWF   ADC_POWER
                      00681         bank0
0233   1283               M         bcf     STATUS,RP0
0234   1303               M         bcf     STATUS,RP1
0235   1700           00682         BSF     FLAG,6
0236   2???           00683         GOTO    RET
0237   081F           00684 ADC03   MOVF    ADCON0,W
0238   3AA1           00685         XORLW   ADC_CORR
0239   1D03           00686         BTFSS   STATUS,Z
023A   2???           00687         GOTO    RET             ; ВЫХОД ИЗ ОБРАБОТКИ
                      00688 ; РЕГУЛЯТОР КАЧЕСТВА СМЕСИ НА МОЩНОСТНОМ РЕЖИМЕ
023B   081E           00689         MOVF    ADRESH,W
023C   00??           00690         MOVWF   MAN_CORR
023D   1500           00691         BSF     FLAG,2
023E   39C0           00692         ANDLW   B'11000000'
023F   1D03           00693         BTFSS   STATUS,Z
0240   2???           00694         GOTO    O2S_OFF
                      00695         bank1
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0241   1683               M         bsf     STATUS,RP0
0242   1303               M         bcf     STATUS,RP1
0243   0D9E           00696         RLF     ADRESL,F        ;сдвиг в лево
                      00697         bank0
0244   1283               M         bcf     STATUS,RP0
0245   1303               M         bcf     STATUS,RP1
0246   0D9E           00698         RLF     ADRESH,F        ;
                      00699         bank1
0247   1683               M         bsf     STATUS,RP0
0248   1303               M         bcf     STATUS,RP1
0249   0D9E           00700         RLF     ADRESL,F
                      00701         bank0
024A   1283               M         bcf     STATUS,RP0
024B   1303               M         bcf     STATUS,RP1
024C   0D1E           00702         RLF     ADRESH,W
024D   00??           00703         MOVWF   temp
                      00704 ; Чтение таблицы преобразования напряжения лямбда-зонда
024E   1300           00705 O2Zr    BCF     ERR,06H
024F   2???           00706         CALL    READ_STR2
0250   00??           00707 O2SET   MOVWF   O2S
0251   ???? ????      00708         PAGESEL RET
0253   2???           00709         GOTO    RET
0254   3000           00710 O2S_OFF MOVLW   00H
0255   1700           00711         BSF     ERR,06H
0256   2???           00712         GOTO    O2SET
                      00713 ;}
                      00714 ;-----------------------------------------------------
                      00715 ; ПОДПРОГРАММА ОБРАБОТКИ ПРЕРЫВАНИЙ UART RxD
                      00716 ;{-----------------------------------------------------
0257   128C           00717 Int_RX  BCF     PIR1,RCIF
0258   081A           00718         Movfw   RCREG
0259                  00719 Read_RX;        MOVWF   RX_DATA
                      00720 ;       BCF     FLAG,7
0259   2???           00721         GOTO    RET
                      00722 ;}
                      00723 ;-----------------------------------------------------
                      00724 ; ПОДПРОГРАММА ОБРАБОТКИ ДТОЖ, ВЫЧИСЛЯЕТСЯ COLT=FFH-ADC+75H, 75H<ADRESH<0B4H
                      00725 ;{-----------------------------------------------------
025A   081E           00726 GET_COLT        MOVF    ADRESH,W        ; Проверяем на попадание в диаппазон показаний датчика температу
                            ры
025B   3E8B           00727         ADDLW   -075H   ; складываем с минимальным значением
025C   3EAB           00728         ADDLW   -(0CAH-075H)    ; Макс-Мин+1
025D   1803           00729         BTFSC   STATUS,C
025E   2???           00730         GOTO    COLT_ERR
                      00731 
025F   3075           00732         MOVLW   075H    ; Вычитаем ОФФСЕТ
0260   029E           00733         SUBWF   ADRESH,F
0261   081E           00734         MOVF    ADRESH,W        ; Если >B4 выключаем режим прогрева
0262   3C3F           00735         SUBLW   0B4H-075H
0263   1480           00736         BSF     STAT,1  ;
0264   1C03           00737         BTFSS   STATUS,C
0265   1080           00738         BCF     STAT,1  ; Гасим флаг прогрева
                      00739 
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0266   081E           00740         MOVF    ADRESH,W        ; Если меньше B3 включаем режим прогрева
0267   3C3D           00741         SUBLW   0B2H-075H
0268   1803           00742         BTFSC   STATUS,C
0269   1480           00743         BSF     STAT,1
                      00744 
026A   1003           00745         BCF     STATUS,C
                      00746         bank1
026B   1683               M         bsf     STATUS,RP0
026C   1303               M         bcf     STATUS,RP1
026D   0D9E           00747         RLF     ADRESL,F        ;сдвиг в лево
                      00748         bank0
026E   1283               M         bcf     STATUS,RP0
026F   1303               M         bcf     STATUS,RP1
0270   0D9E           00749         RLF     ADRESH,F        ;в ADRESH весь рабочий диаппазон прогрева
                      00750 ; Добавлено - вывод полного диаппазона рабочих температур
                      00751  
0271   081E           00752         MOVF    ADRESH,W
0272   00??           00753         MOVWF   ColtF
                      00754 
                      00755 
0273   1C80           00756         BTFSS   STAT,1
0274   2???           00757         GOTO    GC_1
0275   1003           00758         BCF     STATUS,C
                      00759         bank1
0276   1683               M         bsf     STATUS,RP0
0277   1303               M         bcf     STATUS,RP1
0278   0D9E           00760         RLF     ADRESL,F
                      00761         bank0
0279   1283               M         bcf     STATUS,RP0
027A   1303               M         bcf     STATUS,RP1
027B   0D9E           00762         RLF     ADRESH,F
                      00763 
                      00764 ;Задаём обрахную характеристику COLT
027C   30FF           00765         MOVLW   0FFH
027D   061E           00766         XORWF   ADRESH,W        ; ОБМЕН РЕГИСТРА И АККУМУЛЯТОРА
027E   069E           00767         XORWF   ADRESH,F        ; МЕСТАМИ
027F   061E           00768         XORWF   ADRESH,W
0280   021E           00769         SUBWF   ADRESH,W        ; ВЫЧИТАЕМ ИЗ FF СОДЕРЖИМОЕ АЦП
0281   00??           00770         MOVWF   COLT
                      00771 
0282   1D87           00772         BTFSS   WARM_UP
0283   1587           00773         BSF     WARM_UP ;
0284   1200           00774         BCF     ERR,4
0285   0008           00775         RETURN
                      00776 
0286   1600           00777 COLT_ERR        BSF     ERR,4
0287   1080           00778         BCF     STAT,1  ; Гасим флаг прогрева
0288   01??           00779         CLRF    ColtF
0289   2???           00780         GOTO    $+2
028A   1200           00781 GC_1    BCF     ERR,4   
028B   01??           00782         CLRF    COLT
028C   1987           00783         BTFSC   WARM_UP
028D   1187           00784         BCF     WARM_UP ; Выключаем светодиод прогрева
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

028E   0008           00785         RETURN
                      00786 ;}
                      00787 ;---------------------------------------------
                      00788 ; Расчёт времени открытия форсунки
                      00789 ;{---------------------------------------------
028F   1700           00790 LAG     BSF     FLAG,6
                      00791 ;Модуль скользящего среднего
                      00792 ;{      
0290   1800           00793         BTFSC   STAT,0
0291   2???           00794         GOTO    GETLAG
0292   ???? ????      00795         banksel PWR_BUF_IND
0294   30??           00796         MOVLW   PWR_BUF-1       ; Указатель кольцевого буфера
0295   07??           00797         ADDWF   PWR_BUF_IND,W
0296   0084           00798         MOVWF   FSR
0297   ???? ????      00799         banksel ADC_POWER
0299   08??           00800         Movfw   ADC_POWER               ; ЗАГРУЖАЕМ 
029A   0080           00801         MOVWF   INDF            ; В ЯЧЕЙКУ КОЛЬЦЕВОГО БУФЕРА
029B   0B??           00802         decfsz  PWR_BUF_IND,F
029C   2???           00803         GOTO    $+3
029D   3004           00804         MOVLW   .4
029E   00??           00805         MOVWF   PWR_BUF_IND
                      00806 
                      00807 ; Вычисляем скользящее среднее
029F   01??           00808         CLRF    TEMP
02A0   ???? ????      00809         banksel PWR_BUF
02A2   08??           00810         Movfw   PWR_BUF
02A3   07??           00811         ADDWF   PWR_BUF+1,W
02A4   1803           00812         BTFSC   STATUS,C
02A5   0A??           00813         INCF    TEMP,F
                      00814 
02A6   07??           00815         ADDWF   PWR_BUF+2,W
02A7   1803           00816         BTFSC   STATUS,C
02A8   0A??           00817         INCF    TEMP,F
                      00818 
02A9   07??           00819         ADDWF   PWR_BUF+3,W
02AA   1803           00820         BTFSC   STATUS,C
02AB   0A??           00821         INCF    TEMP,F
                      00822         bank0
02AC   1283               M         bcf     STATUS,RP0
02AD   1303               M         bcf     STATUS,RP1
02AE   00??           00823         MOVWF   POWER
02AF   0C??           00824         RRF     TEMP,F
02B0   0C??           00825         RRF     POWER,F
02B1   0C??           00826         RRF     TEMP,F
02B2   0C??           00827         RRF     POWER,F
02B3   08??           00828         Movf    POWER,W         
                      00829         
                      00830 ;}
                      00831 
                      00832 
02B4   08??           00833 GETLAG  Movfw   POWER
02B5   3C96           00834         SUBLW   96H     ; Более 15 вольт
02B6   1C03           00835         BTFSS   STATUS,C
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02B7   2???           00836         GOTO    HVOLT
02B8   3057           00837         MOVLW   57H
02B9   02??           00838         SUBWF   POWER,W
02BA   1D03           00839         BTFSS   STATUS,Z
02BB   1C03           00840         BTFSS   STATUS,C
02BC   2???           00841         GOTO    LVOLT   ; Меньше 8,6в
                      00842 
                      00843 ;       BCF     FLG_C,7
02BD   00??           00844         MOVWF   TEMP    
02BE   390F           00845         ANDLW   0FH
02BF   3C0F           00846         SUBLW   0FH;3FH
02C0   00??           00847         MOVWF   MULc
02C1   1A80           00848         BTFSC   TEMP,5
02C2   2???           00849         GOTO    NTX11V
02C3   1A00           00850         BTFSC   TEMP,4
02C4   2???           00851         GOTO    PWR102
                      00852 
02C5   3086           00853 PWR086  MOVLW   low (LAG086-LAG102)
02C6   00??           00854         MOVWF   Mul1Lo
02C7   3001           00855         MOVLW   high (LAG086-LAG102)    
02C8   00??           00856         MOVWF   Mul1Hi
                      00857 
02C9   30E6           00858         MOVLW   low LAG102
02CA   00??           00859         MOVWF   Temp5
                      00860 
02CB   3005           00861         MOVLW   high LAG102
02CC   00??           00862         MOVWF   Temp4
02CD   2???           00863         GOTO    PWR_CALC
                      00864 
02CE   309A           00865 PWR102  MOVLW   low (LAG102-LAG118)
02CF   00??           00866         MOVWF   Mul1Lo
02D0   3001           00867         MOVLW   high (LAG102-LAG118)    
02D1   00??           00868         MOVWF   Mul1Hi
                      00869 
02D2   304C           00870         MOVLW   low LAG118
02D3   00??           00871         MOVWF   Temp5
                      00872 
02D4   3004           00873         MOVLW   high LAG118
02D5   00??           00874         MOVWF   Temp4
02D6   2???           00875         GOTO    PWR_CALC
                      00876 
                      00877 
02D7   1A00           00878 NTX11V  BTFSC   TEMP,4
02D8   2???           00879         GOTO    PWR134
02D9   30DC           00880 PWR118  MOVLW   low (LAG118-LAG134)
02DA   00??           00881         MOVWF   Mul1Lo
02DB   3000           00882         MOVLW   high (LAG118-LAG134)    
02DC   00??           00883         MOVWF   Mul1Hi
                      00884 
02DD   3070           00885         MOVLW   low LAG134
02DE   00??           00886         MOVWF   Temp5
                      00887 
02DF   3003           00888         MOVLW   high LAG134
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02E0   00??           00889         MOVWF   Temp4
                      00890 
02E1   2???           00891         GOTO    PWR_CALC
                      00892 
                      00893 
02E2   30B4           00894 PWR134  MOVLW   low (LAG134-LAG150)
02E3   00??           00895         MOVWF   Mul1Lo
02E4   3000           00896         MOVLW   high (LAG134-LAG150)    
02E5   00??           00897         MOVWF   Mul1Hi
                      00898 
02E6   30BC           00899         MOVLW   low LAG150
02E7   00??           00900         MOVWF   Temp5
                      00901 
02E8   3002           00902         MOVLW   high LAG150
02E9   00??           00903         MOVWF   Temp4
02EA   2???           00904         GOTO    PWR_CALC
                      00905 
02EB   2???           00906 PWR_CALC        CALL    MUL16_8
02EC   1003           00907         BCF     STATUS,C
02ED   0C??           00908         RRF     ResHi,F
02EE   0C??           00909         RRF     Mul1Hi,F
02EF   0C??           00910         RRF     Mul1Lo,F
                      00911 
02F0   1003           00912         BCF     STATUS,C
02F1   0C??           00913         RRF     ResHi,F
02F2   0C??           00914         RRF     Mul1Hi,F
02F3   0C??           00915         RRF     Mul1Lo,F
                      00916 
                      00917 
02F4   1003           00918         BCF     STATUS,C
02F5   0C??           00919         RRF     ResHi,F
02F6   0C??           00920         RRF     Mul1Hi,F
02F7   0C??           00921         RRF     Mul1Lo,F
                      00922 
                      00923 
02F8   1003           00924         BCF     STATUS,C
02F9   0C??           00925         RRF     ResHi,F
02FA   0C??           00926         RRF     Mul1Hi,F
02FB   0C??           00927         RRF     Mul1Lo,F
                      00928 
02FC   08??           00929         Movfw   Mul1Lo
02FD   07??           00930         ADDWF   Temp5,W
                      00931 
02FE   00??           00932         MOVWF   INJ_LAG_L
                      00933 
02FF   1803           00934         BTFSC   STATUS,C
0300   0A??           00935         INCF    Mul1Hi,F
                      00936 
0301   08??           00937         Movfw   Mul1Hi
0302   07??           00938         ADDWF   Temp4,W
                      00939 
0303   00??           00940         MOVWF   INJ_LAG_H
                      00941 
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0304   0008           00942         RETURN
                      00943 HVOLT   let     INJ_LAG_H,high LAG150
0305   3002               M         movlw   high .700
0306   00??               M         movwf   INJ_LAG_H
                      00944         let     INJ_LAG_L,low LAG150
0307   30BC               M         movlw   low .700
0308   00??               M         movwf   INJ_LAG_L
0309   0008           00945         RETURN
                      00946 LVOLT   let     INJ_LAG_H,high LAG086
030A   3007               M         movlw   high .1900
030B   00??               M         movwf   INJ_LAG_H
                      00947         let     INJ_LAG_L,low LAG086
030C   306C               M         movlw   low .1900
030D   00??               M         movwf   INJ_LAG_L
030E   0008           00948         RETURN
                      00949 ;}
                      00950 ;---------------------------------------------------------------------
                      00951 
                      00952 
                      00953 ;------------------ Импульс зажигания -----------------------
                      00954 
                      00955 ;tm2    btfss   PIR1,CCP1IF              ;ждем момент зажигания
                      00956 ;       goto    tm2
                      00957 ;tm3    bsf     PORTC,0         ;    ;импульс зажигания
                      00958 ;       call    zadimp         ;длина импульса  
                      00959 ;       bcf     PORTC,0               ;сброс импульса зажигания
                      00960 ;       goto    RET         ;выходим                  
                      00961 
                      00962 
030F                  00963 EE_ADR  ; Установка адреса работы с энергонезависимой памятью   
030F   1283 1703      00964         banksel EEADR
0311   008D           00965         movwf   EEADR       ; Скопировать W в регистр EEAdr
                      00966         bank0
0312   1283               M         bcf     STATUS,RP0
0313   1303               M         bcf     STATUS,RP1
0314   0008           00967         return
0315                  00968 EE_READ ; чтение данных из энергонезависимой памяти EEPROM (ПЗУ)        
0315   1683 1703      00969         banksel EECON1
0317   140C           00970         bsf     EECON1,RD    ; Инициализировать чтение.
0318   1283 1703      00971         banksel EEDATA
031A   080C           00972         movf    EEDATA,W    ; Скопировать в W из EEPROM
                      00973         bank0
031B   1283               M         bcf     STATUS,RP0
031C   1303               M         bcf     STATUS,RP1
031D   0008           00974         return
                      00975 
031E                  00976 EE_WRITE        ; запись данных в энергонезависимую память EEPROM (ПЗУ)
031E   138B           00977         BCF     INTCON,GIE      ; Глобальный запрет прерываний
031F   008C           00978             movwf       EEDATA      ; Скопировать W в EEPROM
0320   1683 1703      00979         banksel EECON1
0322   148C           00980            bsf  EECON1,WR    ; Разрешить запись.
                      00981                                    
0323   3055           00982             movlw      55h         ; Обязательная
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0324   008D           00983            movwf      EECON2      ; процедура
0325   30AA           00984            movlw      0AAh         ; при записи.
0326   008D           00985            movwf      EECON2      ; ----"----
0327   148C           00986            bsf        EECON1,WR    ; ----"----
                      00987 
0328   120C           00988            bcf        EECON1,EEIF    ; Сбросить флаг прерывания по окончании
                      00989            bank0                ; Переход в нулевой банк.
0329   1283               M         bcf     STATUS,RP0
032A   1303               M         bcf     STATUS,RP1
032B   178B           00990         BSF     INTCON,GIE
032C   0008           00991         RETURN
                      00992 
                      00993 
                      00994         #include DIV24x16.asm
                      00001 ;       list      p=16f628A           ; list directive to define processor
                      00002 ;       #include <p16F628A.inc>       ; processor specific variable definitions
                      00003 ;       errorlevel  -302              ; suppress message 302 from list file
                      00004 
                      00005 ;------------------------------------------------------------------------------------------------
                      00006 ;П/п деления Mul2Lo, Mul2Hi, Res2Hi на DivLo, DivHi. Результат помещается в Mul2Lo, Mul2Hi.
                      00007 ;!!! Mul2Lo, Mul2Hi, Res2Hi и Res1,Res2,Res3 должны быть в ОЗУ друг за другом
                      00008 ;udata_ovr 
                      00009 ;Temp 1
                      00010 ;Temp2 1
                      00011 ;Temp3 1
                      00012 ;Cnt2 1
                      00013 #define Tmp     Flag_Math,0
032D                  00014 Div24_16
032D   01??           00015         clrf Temp
032E   01??           00016         clrf Temp2
032F   01??           00017         clrf Temp3
0330   01??           00018         clrf Cnt2
0331   01??           00019         clrf Res1
0332   01??           00020         clrf Res2
0333   01??           00021         clrf Res3
                      00022 
                      00023 
0334   30F0           00024         movlw 0xf0
0335   05??           00025         andwf DivHi,0
0336   1903           00026         btfsc STATUS,Z
0337   2???           00027         goto chknxt
                      00028         
0338   08??           00029         movf Res2Hi,0
0339   00??           00030         movwf Temp2
033A   08??           00031         movf Mul2Hi,0
033B   00??           00032         movwf Temp
033C   3002           00033         movlw .2
033D   00??           00034         movwf CntDiv
033E   2???           00035         goto StartDiv   
                      00036         
                      00037         
033F                  00038 chknxt
033F   08??           00039         movf DivHi,1
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0340   1903           00040         btfsc STATUS,Z
0341   2???           00041         goto chknxt1
0342   30F0           00042         movlw 0xf0
0343   05??           00043         andwf Res2Hi,0
0344   00??           00044         movwf Temp2
0345   0E??           00045         swapf Temp2,1
                      00046         
0346   300F           00047         movlw 0x0f
0347   05??           00048         andwf Res2Hi,0
0348   00??           00049         movwf Temp
0349   0E??           00050         swapf Temp,1
                      00051 
034A   30F0           00052         movlw 0xf0
034B   05??           00053         andwf Mul2Hi,0
034C   00??           00054         movwf Temp3
034D   0E??           00055         swapf Temp3,0
034E   04??           00056         iorwf Temp,1
034F   01??           00057         clrf Temp3
0350   3003           00058         movlw .3
0351   00??           00059         movwf CntDiv
0352   2???           00060         goto StartDiv
0353                  00061 chknxt1
                      00062 
0353   30F0           00063         movlw 0xf0
0354   05??           00064         andwf DivLo,0
0355   1903           00065         btfsc STATUS,Z
0356   2???           00066         goto chknxt2
                      00067 
0357   08??           00068         movf Res2Hi,0
0358   00??           00069         movwf Temp
0359   3004           00070         movlw .4
035A   00??           00071         movwf CntDiv
035B   2???           00072         goto StartDiv
035C                  00073 chknxt2
035C   30F0           00074         movlw 0xf0
035D   05??           00075         andwf Res2Hi,0
035E   00??           00076         movwf Temp
035F   0E??           00077         swapf Temp,1
0360   3005           00078         movlw .5
0361   00??           00079         movwf CntDiv
                      00080 
0362                  00081 StartDiv
                      00082 
                      00083 
0362   0064           00084 sbagn   CLRWDT
0363   2???           00085         call Sub
0364   1800           00086         btfsc Tmp
0365   2???           00087         goto FinSub
0366   0A??           00088         incf Cnt2,1
0367   2???           00089         goto sbagn
                      00090 
                      00091 
                      00092 
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00093 
0368                  00094 FinSub
0368   08??           00095         movf DivLo,0
0369   07??           00096         addwf Temp,1    
036A   1C03           00097         btfss STATUS,C
036B   2???           00098         goto add2nd
036C   0F??           00099         incfsz Temp2,1
036D   2???           00100         goto add2nd
036E   0A??           00101         incf Temp3,1
                      00102         
036F                  00103 add2nd
036F   08??           00104         movf DivHi,0    
0370   07??           00105         addwf Temp2,1
0371   1C03           00106         btfss STATUS,C  
0372   2???           00107         goto jpqm
0373   0A??           00108         incf Temp3,1
0374                  00109 jpqm
0374   1003           00110         bcf STATUS,C
0375   0C??           00111         rrf CntDiv,0
0376   0084           00112         movwf FSR
0377   30??           00113         movlw Res1
0378   0784           00114         addwf FSR,1
0379   1C00           00115         btfss CntDiv,0
037A   2???           00116         goto nnhjuq
037B   0E??           00117         swapf Cnt2,0
037C   0480           00118         iorwf INDF,1
037D   2???           00119         goto ffr
037E                  00120 nnhjuq
037E   08??           00121         movf Cnt2,0
037F   0480           00122         iorwf INDF,1
0380                  00123 ffr
0380   03??           00124         decf CntDiv,1
0381   30FF           00125         movlw 0xff
0382   02??           00126         subwf CntDiv,0
0383   1D03           00127         btfss STATUS,Z
                      00128 
0384   2???           00129         goto notFin
0385   2???           00130         goto FinDiv
0386                  00131 notFin  
0386   1003           00132         bcf STATUS,C
0387   0D??           00133         rlf Temp,1
0388   0D??           00134         rlf Temp2,1
0389   0D??           00135         rlf Temp3,1
038A   1003           00136         bcf STATUS,C    
038B   0D??           00137         rlf Temp,1
038C   0D??           00138         rlf Temp2,1
038D   0D??           00139         rlf Temp3,1
038E   1003           00140         bcf STATUS,C    
038F   0D??           00141         rlf Temp,1
0390   0D??           00142         rlf Temp2,1
0391   0D??           00143         rlf Temp3,1
0392   1003           00144         bcf STATUS,C    
0393   0D??           00145         rlf Temp,1
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0394   0D??           00146         rlf Temp2,1
0395   0D??           00147         rlf Temp3,1
                      00148 
0396   1003           00149         bcf STATUS,C
0397   0C??           00150         rrf CntDiv,0
0398   0084           00151         movwf FSR
0399   30??           00152         movlw Mul2Lo
039A   0784           00153         addwf FSR,1
039B   1800           00154         btfsc CntDiv,0
039C   2???           00155         goto nnhq
039D   300F           00156         movlw 0x0f
039E   0500           00157         andwf INDF,0
039F   04??           00158         iorwf Temp,1
03A0   2???           00159         goto jjddsak
03A1                  00160 nnhq
03A1   0E00           00161         swapf INDF,0
03A2   390F           00162         andlw 0x0f
03A3   04??           00163         iorwf Temp,1
03A4                  00164 jjddsak
03A4   01??           00165         clrf Cnt2
03A5   2???           00166         goto sbagn      
03A6                  00167 FinDiv
03A6   1003           00168         bcf STATUS,C            ;Округление
03A7   0C??           00169         rrf DivHi,1
03A8   0C??           00170         rrf DivLo,1
03A9   08??           00171         movf DivHi,0
03AA   02??           00172         subwf Temp2,0
03AB   1C03           00173         btfss STATUS,C
03AC   2???           00174         goto dsgfadsg
03AD   1D03           00175         btfss STATUS,Z
03AE   2???           00176         goto cxv
03AF   08??           00177         movf DivLo,0
03B0   02??           00178         subwf Temp,0
03B1   1C03           00179         btfss STATUS,C  
03B2   2???           00180         goto dsgfadsg
03B3                  00181 cxv
03B3   0F??           00182         incfsz Res1,1
03B4   2???           00183         goto dsgfadsg
03B5   0F??           00184         incfsz Res2,1
03B6   2???           00185         goto dsgfadsg
03B7   0A??           00186         incf Res3,1
03B8                  00187 dsgfadsg
03B8   08??           00188         movf Res1,0
03B9   00??           00189         movwf Mul2Lo
03BA   08??           00190         movf Res2,0
03BB   00??           00191         movwf Mul2Hi
03BC   08??           00192         movf Res3,0
03BD   00??           00193         movwf Res2Hi
03BE   0008           00194         return
03BF                  00195 Sub
03BF   1000           00196         bcf Tmp
03C0   08??           00197         movf DivLo,0            
03C1   02??           00198         subwf Temp,1            
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03C2   1803           00199         btfsc STATUS,C          
03C3   2???           00200         goto sub2nd             
03C4   03??           00201         decf Temp2,1            
03C5   30FF           00202         movlw 0xff              
03C6   02??           00203         subwf Temp2,0           
03C7   1D03           00204         btfss STATUS,Z          
03C8   2???           00205         goto sub2nd             
03C9   03??           00206         decf Temp3,1            
03CA   30FF           00207         movlw 0xff              
03CB   02??           00208         subwf Temp3,0           
03CC   1903           00209         btfsc STATUS,Z          
03CD   1400           00210         bsf Tmp                 
03CE                  00211 sub2nd
03CE   08??           00212         movf DivHi,0
03CF   02??           00213         subwf Temp2,1
03D0   1803           00214         btfsc STATUS,C
03D1   0008           00215         return
03D2   03??           00216         decf Temp3,1
03D3   30FF           00217         movlw 0xff
03D4   02??           00218         subwf Temp3,0
03D5   1903           00219         btfsc STATUS,Z
03D6   1400           00220         bsf Tmp
03D7   0008           00221         return
                      00995 
                      00996         #include MUL8x8.asm
  00000001            00001 SAME    EQU             1
                      00002 
                      00003 MULT    MACRO   BIT
                      00004         BTFSC   MULp,BIT
                      00005         ADDWF   H_byte,SAME
                      00006         RRF     H_byte,SAME
                      00007         RRF     L_byte,SAME
                      00008         ENDM
                      00009 
03D8   01??           00010 MUL8    CLRF    H_byte
03D9   01??           00011         CLRF    L_byte
03DA   08??           00012         MOVF    MULc,W
03DB   1003           00013         BCF     STATUS,C
                      00014         MULT    0
03DC   1800               M         BTFSC   MULp,0
03DD   07??               M         ADDWF   H_byte,SAME
03DE   0C??               M         RRF     H_byte,SAME
03DF   0C??               M         RRF     L_byte,SAME
                      00015         MULT    1
03E0   1880               M         BTFSC   MULp,1
03E1   07??               M         ADDWF   H_byte,SAME
03E2   0C??               M         RRF     H_byte,SAME
03E3   0C??               M         RRF     L_byte,SAME
                      00016         MULT    2
03E4   1900               M         BTFSC   MULp,2
03E5   07??               M         ADDWF   H_byte,SAME
03E6   0C??               M         RRF     H_byte,SAME
03E7   0C??               M         RRF     L_byte,SAME
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00017         MULT    3
03E8   1980               M         BTFSC   MULp,3
03E9   07??               M         ADDWF   H_byte,SAME
03EA   0C??               M         RRF     H_byte,SAME
03EB   0C??               M         RRF     L_byte,SAME
                      00018         MULT    4
03EC   1A00               M         BTFSC   MULp,4
03ED   07??               M         ADDWF   H_byte,SAME
03EE   0C??               M         RRF     H_byte,SAME
03EF   0C??               M         RRF     L_byte,SAME
                      00019         MULT    5
03F0   1A80               M         BTFSC   MULp,5
03F1   07??               M         ADDWF   H_byte,SAME
03F2   0C??               M         RRF     H_byte,SAME
03F3   0C??               M         RRF     L_byte,SAME
                      00020         MULT    6
03F4   1B00               M         BTFSC   MULp,6
03F5   07??               M         ADDWF   H_byte,SAME
03F6   0C??               M         RRF     H_byte,SAME
03F7   0C??               M         RRF     L_byte,SAME
                      00021         MULT    7
03F8   1B80               M         BTFSC   MULp,7
03F9   07??               M         ADDWF   H_byte,SAME
03FA   0C??               M         RRF     H_byte,SAME
03FB   0C??               M         RRF     L_byte,SAME
                      00022 
03FC   3400           00023         RETLW   0
                      00997         #include rhh.asm
                      00001 ;-------------------------------------------------------------
                      00002 ;      Библиотека управления шаговым двигателем
                      00003 ;-------------------------------------------------------------
                      00004 ;
                      00005 ;        DELAY    - Подпрограмма задержки
                      00006 ;
                      00007 ;        STPINIT  - Инициализация шагового двигателя, делает 255 шагов на закрытие, и 70 на открытие
                      00008 ;        STPUP    - Открыть заслонку на один шаг
                      00009 ;        STPDOWN  - На один шаг закрыть
                      00010 ;
                      00011 ;
                      00012 ;        STPCNT  - Переменная указывает текущую позицию шагового двигателя
                      00013 
                      00014 ;====================================================
                      00015 ;#DEFINE        STEPA   PORTB,0  ;
                      00016 ;#DEFINE        STEPB   PORTB,1  ;
                      00017 ;=====================================================
                      00018 STPINIT let     STPCNT,IAC_MAX  ;Сбрасываем счётчик ходов
03FD   3078               M         movlw   D'120'
03FE   00??               M         movwf   STPCNT
03FF   2???           00019 STPI    CALL    STPDOWN         ;Делаем IAC_MAX ходов в сторону закрытия
0400   2???           00020         CALL    DELAY           ;Задержка между импульсами
0401   0B??           00021         DECFSZ  STPCNT,F
0402   2???           00022         GOTO    STPI
0403   1600           00023         BSF     FLAG,4          ;Включаем флаг на позиционирование РХХ
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00024         let     IAC_INIT,IAC_WARM
0404   3019               M         movlw   D'25'
0405   00??               M         movwf   IAC_INIT
0406   0008           00025         RETURN
                      00026 
0407   1800           00027 ST_INI  BTFSC   STAT,0
0408   2???           00028         GOTO    SET_STEP
0409   0000           00029  NOP
                      00030 ;ДОБАВЛЕНА ФУНКЦИЯ КВАДРАТИЧНОЙ ИНТЕРПОЛЯЦИИ
                      00031         movab   COLT,MULc               ; COLT^2
040A   08??               M         movfw   COLT
040B   00??               M         movwf   MULc
                      00032         movab   COLT,MULp
040C   08??               M         movfw   COLT
040D   00??               M         movwf   MULp
040E   2???           00033         CALL    MUL8
                      00034         movab   H_byte,MULc
040F   08??               M         movfw   H_byte
0410   00??               M         movwf   MULc
                      00035 ; САМА ИНТЕРПОЛЯЦИЯ
                      00036 ;       movab   COLT,MULc
                      00037         let     MULp,IAC_COLT-IAC_WARM
0411   304B               M         movlw   D'100'-D'25'
0412   00??               M         movwf   MULp
0413   2???           00038         CALL    MUL8
                      00039 
0414   08??           00040         MOVF    H_byte,W
0415   3E19           00041         ADDLW   IAC_WARM
0416   00??           00042         MOVWF   IAC_INIT
                      00043 
0417                  00044 SET_STEP        ;CALL   SETSTP
0417   2???           00045         CALL    STPUP                   ;выставляем шаговик в начальное положение
0418   08??           00046         MOVFW   STPCNT
0419   02??           00047         SUBWF   IAC_INIT,W
041A   1D03           00048         BTFSS   STATUS,Z
041B   1C03           00049         BTFSS   STATUS,C
041C   1200           00050         BCF     FLAG,4
041D   0008           00051         RETURN
                      00052 
                      00053 ;       ФАЗА:   F1      F2      F3      F4
                      00054 ;       PORTB,0 1       0       0       1       - Линия А
                      00055 ;       PORTB,1 1       1       0       0       - Линия Б
                      00056 ; УСТАНОВКА РХХ СОГЛАСНО ПЕРЕМЕННОЙ РУЧНОЙ КАЛИБРОВКИ
                      00057 IFDEF MANSETIAC
041E   1003           00058 SET_MAN BCF     STATUS,C
041F   0C??           00059         RRF     MAN_CORR,W      
                      00060 ; УСТАНОВКА В ПОЗИЦИЮ УКАЗАНУЮ В W
0420   02??           00061 SETSTP  SUBWF   STPCNT,W                ; Вычитаем из аккумулятора положение РХХ
0421   1C03           00062         BTFSS   STATUS,C
0422   2???           00063         GOTO    STPUP   
                      00064 
0423   1D03           00065         BTFSS   STATUS,Z
0424   2???           00066         GOTO    STPD
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0425   0008           00067         RETURN
                      00068 endif
                      00069 
                      00070 
                      00071 
                      00072 
                      00073 
                      00074 ; ===========================================================================
                      00075 ; Стабилизация оборотов коленчатого вала двигателя
                      00076 ; ===========================================================================
0426   1180           00077 STAB    BCF     FLAG,3          ; Сброс флага обработки
0427   1A00           00078         BTFSC   FLAG,4          ; Флаг позиционирования РХХ
0428   2???           00079         GOTO    ST_INI
                      00080 IFDEF MANSETIAC
0429   1A05           00081         BTFSC   PIN1            ; Ручное управление РХХ
042A   2???           00082         GOTO    SET_MAN
                      00083 endif
042B   1C00           00084         BTFSS   STAT,0          ; Проверка запуска двигателя
042C   0008           00085         RETURN
                      00086 IFDEF IAC_TRSH
                      00087 ; Схема замедления скорости движения РХХ
042D   3014           00088         MOVLW   IAC_TRSH
042E   02??           00089         SUBWF   STPCNT,W                ; 
042F   1803           00090         BTFSC   STATUS,C
0430   2???           00091         GOTO    STABSTAT
0431   1900           00092         BTFSC   Flag_Math,2
0432   2???           00093         GOTO    STABSTAT
0433   1500           00094         BSF     Flag_Math,2             
0434   0008           00095         RETURN
0435   1100           00096 STABSTAT        BCF     Flag_Math,2
                      00097 ENDIF   
                      00098 
                      00099 IFDEF DEMFER
0436   1900           00100         BTFSC   STAT,2          ; Проверка холостого хода
0437   2???           00101         GOTO    DEMFEROUT
0438   301A           00102         MOVLW   DEMFER
0439   02??           00103         SUBWF   STPCNT,W                ; Вычитаем из аккумулятора положение РХХ
043A   1C03           00104         BTFSS   STATUS,C
043B   2???           00105         GOTO    STPUP
043C                  00106 DEMFEROUT
                      00107 ENDIF
                      00108 IFDEF WARM_TRSH
                      00109 #define TRSHH   (WARM_TRSH+.273)*.51 ;MPASM больше трёх скобок не обрабатывает
043C   3057           00110         MOVLW   .255-(((TRSHH/.100)-075H)*.4)
043D   02??           00111         SUBWF   COLT,W
043E   1803           00112         BTFSC   STATUS,C
043F   2???           00113         GOTO    WST
0440   1B80           00114         BTFSC   STAT,7
0441   2???           00115         GOTO    WST
                      00116 ENDIF
                      00117 IFNDEF WARM_TRSH
                      00118         BTFSC   COLT,7; STAT,1  ; Проверка прогрева двигателя
                      00119         GOTO    WST
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00120         BTFSC   STAT,7
                      00121         GOTO    WST
                      00122 ENDIF
                      00123 
                      00124 
0442   3021           00125 STABILIZE       MOVLW   (SPD_HOT/.25)-.1        ; Нижний порог оборотов
0443   02??           00126         SUBWF   SPD,W           ; 
0444   1803           00127         BTFSC   STATUS,C
0445   2???           00128         GOTO    STABH
0446   01??           00129         CLRF    STP_CNT_DWN
0447   3E09           00130         ADDLW   .9
0448   1C03           00131         BTFSS   STATUS,C        
0449   2???           00132         GOTO    STABOPN
044A   3021           00133         MOVLW   (SPD_HOT/.25)-.1        ; Нижний порог оборотов
044B   02??           00134         SUBWF   SPD,W           ; 
044C   2???           00135         CALL    DELT_DEL_UP
044D   0A??           00136         INCF    STP_CNT_UP,F            ;
044E   08??           00137         MOVF    STP_CNT_UP,W
044F   02??           00138         SUBWF   STP_SPEED,W
0450   1D03           00139         BTFSS   STATUS,Z
0451   1C03           00140         BTFSS   STATUS,C
0452   2???           00141 STABOPN CALL    STPUP           ; На один шаг открыть дроссельный канал
0453   0008           00142         RETURN
                      00143 
0454   01??           00144 STABH   CLRF    STP_CNT_UP
0455   1D00           00145         BTFSS   STAT,2          ; Проверка холостого хода
0456   0008           00146         RETURN
                      00147                 
0457   3024           00148         MOVLW   (SPD_HOT/.25)+.2        ; Верхний порог оборотов
0458   02??           00149         SUBWF   SPD,W
0459   1D03           00150         BTFSS   STATUS,Z
045A   1C03           00151         BTFSS   STATUS,C        
045B   0008           00152         RETURN
045C   3C20           00153         SUBLW   020H            ; более 20*25об/мин без задержки
045D   1C03           00154         BTFSS   STATUS,C                ; без задержки
045E   2???           00155         GOTO    CLWWHTDEL
                      00156 
045F   08??           00157         MOVF    SPD,W
0460   3C24           00158         SUBLW   (SPD_HOT/.25)+.2        ; Верхний порог оборотов
0461   2???           00159         CALL    DELT_DEL
0462   0A??           00160         INCF    STP_CNT_DWN,F
0463   08??           00161         MOVF    STP_CNT_DWN,W
0464   02??           00162         SUBWF   STP_SPEED,W
0465   1D03           00163         BTFSS   STATUS,Z
0466   1C03           00164         BTFSS   STATUS,C
0467   2???           00165 CLWWHTDEL       CALL    STPD
0468   0008           00166         RETURN
                      00167 ;Стабилизация оборотов на прогреве
0469   3030           00168 WST     MOVLW   (SPD_WARM/.25)-.2       ; Нижний порог оборотов
046A   02??           00169         SUBWF   SPD,W           ; 
046B   1803           00170         BTFSC   STATUS,C
046C   2???           00171         GOTO    STABHWR
046D   01??           00172         CLRF    STP_CNT_DWN
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

046E   3E09           00173         ADDLW   .9
046F   1C03           00174         BTFSS   STATUS,C        
0470   2???           00175         GOTO    STABOPN
0471   3030           00176         MOVLW   (SPD_WARM/.25)-.2       ; Нижний порог оборотов
0472   02??           00177         SUBWF   SPD,W           ; 
0473   2???           00178         CALL    DELT_DEL_UP
0474   0A??           00179         INCF    STP_CNT_UP,F
0475   08??           00180         MOVF    STP_CNT_UP,W
0476   02??           00181         SUBWF   STP_SPEED,W
0477   1D03           00182         BTFSS   STATUS,Z
0478   1C03           00183         BTFSS   STATUS,C
0479   2???           00184         CALL    STPUP           ; На один шаг открыть дроссельный канал
047A   0008           00185         RETURN
                      00186 
047B   01??           00187 STABHWR CLRF    STP_CNT_UP
047C   1D00           00188         BTFSS   STAT,2          ; Проверка холостого хода
047D   0008           00189         RETURN
                      00190         
047E   3034           00191         MOVLW   (SPD_WARM/.25)+.2       ; Верхний порог оборотов
047F   02??           00192         SUBWF   SPD,W
0480   1D03           00193         BTFSS   STATUS,Z
0481   1C03           00194         BTFSS   STATUS,C        
0482   0008           00195         RETURN
0483   3C20           00196         SUBLW   020H            ; более 20*25об/мин без задержки
0484   1C03           00197         BTFSS   STATUS,C                ; без задержки
0485   2???           00198         GOTO    CLWWHTDELWR
                      00199 
0486   08??           00200         MOVF    SPD,W
0487   3C34           00201         SUBLW   (SPD_WARM/.25)+.2       ; Верхний порог оборотов
0488   2???           00202         CALL    DELT_DEL
0489   0A??           00203         INCF    STP_CNT_DWN,F
048A   08??           00204         MOVF    STP_CNT_DWN,W
048B   02??           00205         SUBWF   STP_SPEED,W
048C   1D03           00206         BTFSS   STATUS,Z
048D   1C03           00207         BTFSS   STATUS,C
048E   2???           00208 CLWWHTDELWR     CALL    STPD
048F   0008           00209         RETURN
                      00210 
                      00211 ;----------------------------------------------------
                      00212 ;     ДВИЖЕНИЕ ШАГОВИКОМ НА ШАГ ОТКРЫТЬ
                      00213 ;----------------------------------------------------
0490   01??           00214 STPUP   CLRF    STP_CNT_UP
0491   08??           00215         MOVF    STPCNT,W                ; ПРОВЕРКА НА МАКСИМАЛЬНОЕ ОТКРЫТИЕ
0492   3C78           00216         SUBLW   IAC_MAX         ; МАКС КОЛИЧЕСТВО ШАГОВ
0493   1C03           00217         BTFSS   STATUS,C                ;
0494   0008           00218         RETURN                  ; ЕСЛИ ДА-ТО ВЫХОДИМ
0495   0A??           00219         INCF    STPCNT,F
0496   1D06           00220         BTFSS   STEPA           ; ПРОВЕРКА ЛИИ А
0497   2???           00221         GOTO    STUA0
0498   1D86           00222         BTFSS   STEPB
0499   2???           00223         GOTO    STUB0
049A   1106           00224         BCF     STEPA           ;F2
049B   0008           00225         RETURN
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

049C   1586           00226 STUB0   BSF     STEPB           ;F1
049D   0008           00227         RETURN
049E   1D86           00228 STUA0   BTFSS   STEPB
049F   2???           00229         GOTO    STUB20
04A0   1186           00230         BCF     STEPB           ;F3
04A1   0008           00231         RETURN
04A2   1506           00232 STUB20  BSF     STEPA           ;F4
04A3   0008           00233         RETURN
                      00234 
                      00235 ;-------------------------------------------
                      00236 ;   ДВИЖЕНИЕ ШАГОВИКОМ НА ЗАКРЫВАНИЕ
                      00237 ;-------------------------------------------
04A4   01??           00238 STPD    CLRF    STP_CNT_DWN
04A5   3008           00239         MOVLW   IAC_MIN
04A6   1880           00240         BTFSC   STAT,1
04A7   3008           00241         MOVLW   IAC_MIN ; Проверка на минимальное полодение РХХ
04A8   02??           00242         SUBWF   STPCNT,W
04A9   1803           00243         BTFSC   STATUS,C
04AA   1903           00244         BTFSC   STATUS,Z
04AB   0008           00245         RETURN
04AC   03??           00246         DECF    STPCNT,F
04AD   1D06           00247 STPDOWN         BTFSS   STEPA           ; ПРОВЕРКА ЛИИ А
04AE   2???           00248         GOTO    STDA0
04AF   1D86           00249         BTFSS   STEPB
04B0   2???           00250         GOTO    STDB0
04B1   1186           00251         BCF     STEPB           ;F4
04B2   0008           00252         RETURN
04B3   1106           00253 STDB0   BCF     STEPA           ;F3
04B4   0008           00254         RETURN
04B5   1D86           00255 STDA0   BTFSS   STEPB
04B6   2???           00256         GOTO    STDB20
04B7   1506           00257         BSF     STEPA   ;F1
04B8   0008           00258         RETURN
04B9   1586           00259 STDB20  BSF     STEPB           ;F2
04BA   0008           00260         RETURN
                      00261 
                      00262 ; Подпрограммы вычисления скорости движения РХХ
                      00263 ; 
04BB   3E01           00264 DELT_DEL        ADDLW   .1
04BC   1D03           00265         BTFSS   STATUS,Z
04BD   2???           00266         GOTO    $+4
04BE   30FF           00267         MOVLW   0FFH            ; МАКСИМАЛЬНАЯ ЗАДЕРЖКА ПРИ РАЗНИЦЕ 25 ОБ/МИН
04BF   00??           00268         MOVWF   STP_SPEED
04C0   0008           00269         RETURN
04C1   01??           00270         CLRF    STP_SPEED
04C2   1780           00271         BSF     STP_SPEED,7             ; STP_CN=80H
04C3   3E02           00272 DEL_LOOP        ADDLW   .2              ; коэфф замедления
04C4   1803           00273         BTFSC   STATUS,C
04C5   0008           00274         RETURN
04C6   0C??           00275         RRF     STP_SPEED,F
04C7   2???           00276         GOTO    DEL_LOOP
                      00277 
                      00278 ; DELTA TO DELAY UP
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04C8   3E01           00279 DELT_DEL_UP     ADDLW   .1
04C9   1D03           00280         BTFSS   STATUS,Z
04CA   2???           00281         GOTO    $+4
04CB   30FF           00282         MOVLW   0FFH            ; МАКСИМАЛЬНАЯ ЗАДЕРЖКА ПРИ РАЗНИЦЕ 25 ОБ/МИН
04CC   00??           00283         MOVWF   STP_SPEED
04CD   0008           00284         RETURN
04CE   01??           00285         CLRF    STP_SPEED
04CF   1780           00286         BSF     STP_SPEED,7             ; STP_CN=80H
04D0   3E01           00287 DEL_LOOP_UP     ADDLW   .1
04D1   1803           00288         BTFSC   STATUS,C
04D2   0008           00289         RETURN
04D3   0C??           00290         RRF     STP_SPEED,F
04D4   2???           00291         GOTO    DEL_LOOP_UP
                      00998         #include calc.asm
                      00001 ;-----------------------------------------------------
                      00002 ; Расчёт цикловой подачи топлива, работает в основном цикле
                      00003 ;-----------------------------------------------------
04D5   1380           00004 M_CALC  BCF     FLAG,7
04D6   1800           00005         BTFSC   STAT,0          ; Проверяем двигатель
04D7   2???           00006         GOTO    CALC            ; Двигатель включён и имеет обороты >400
04D8   1300           00007         BCF     STAT,6
                      00008 ;-----------------------------------------------------------
                      00009 ; Вычисление времени впрыска на пуске двигателя
                      00010 ;{----------------------------------------------------------
04D9   08??           00011         MOVF    TPS,W           ; Записываем положение ДЗ       
04DA   3C9A           00012         SUBLW   FL_CLEAR*.255/.5000     ; Порог включения режима продувки
04DB   1803           00013         BTFSC   STATUS,C                ; Если положение ДЗ меньше порога
04DC   2???           00014         GOTO    $+4
04DD   01??           00015         CLRF    T_INJ_H         ; Минимальное время открытия форсунки
04DE   01??           00016         CLRF    T_INJ_L
04DF   0008           00017         RETURN
                      00018 ;ДОБАВЛЕНА ФУНКЦИЯ КВАДРАТИЧНОЙ ИНТЕРПОЛЯЦИИ
                      00019         movab   COLT,MULc               ; COLT^2
04E0   08??               M         movfw   COLT
04E1   00??               M         movwf   MULc
                      00020         movab   COLT,MULp
04E2   08??               M         movfw   COLT
04E3   00??               M         movwf   MULp
04E4   2???           00021         CALL    MUL8
                      00022         movab   H_byte,MULc
04E5   08??               M         movfw   H_byte
04E6   00??               M         movwf   MULc
                      00023 ; САМА ИНТЕРПОЛЯЦИЯ
04E7   01??           00024         CLRF    Mul1Hi
                      00025 ;       movab   COLT,MULc               ; Температура двигателя - множитель
04E8   3078           00026         MOVLW   low (CRANK_COLT-CRANK_HOT)
04E9   00??           00027         MOVWF   Mul1Lo          ; Разность врмён впрыска - множимое
                      00028         
04EA   3069           00029         MOVLW   high (CRANK_COLT-CRANK_HOT)
04EB   00??           00030         MOVWF   Mul1Hi          ; Разность врмён впрыска - множимое
                      00031 
04EC   2???           00032         CALL    MUL16_8         ; Умножение 16х8
04ED   08??           00033         MOVF    Mul1Hi,W
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04EE   3EB8           00034         ADDLW   low CRANK_HOT
04EF   00??           00035         MOVWF   T_INJ_L
04F0   1803           00036         BTFSC   STATUS,C                ; проверяем CARRY
04F1   0A??           00037         INCF    ResHi,F
04F2   08??           00038         MOVF    ResHi,W
04F3   3E0B           00039         ADDLW   high CRANK_HOT
04F4   00??           00040         MOVWF   T_INJ_H
                      00041 
                      00042 ;       BSF     STAT,7
04F5   01??           00043         CLRF    D_TPS
04F6   1100           00044         BCF     ERR,2
                      00045         ;CALL   STPUP           ; по шагу открываем дроссель
04F7   0008           00046         RETURN
                      00047 ;}
                      00048 ;-----------------------------------------------------
                      00049 ; Основной расчёт времени впрыска
                      00050 ; TI = RCO + ((MAP-Offset)(RqF - RCO) / 256) 
                      00051 ;-----------------------------------------------------
04F8   01??           00052 CALC    CLRF    Mul1Hi
                      00053 ; Вычисляем уровень обогащения при прогреве
                      00054 ;{-------------------------------------------------------
                      00055 ; ENR_12 = -12   B8h
                      00056 ; ENR_COLT +20   40h
                      00057 ; ENR_MID  +50   09h
                      00058 ; ENR_HOT  +80   0h
                      00059  ;let COLT,079H
04F9   1F80           00060         BTFSS   COLT,7
04FA   2???           00061         GOTO    COLT_MID
04FB   1F00           00062         BTFSS   COLT,6
04FC   2???           00063         GOTO    COLT_MID2
                      00064 ; -12 to -43
                      00065         movab   COLT,MULc
04FD   08??               M         movfw   COLT
04FE   00??               M         movwf   MULc
04FF   1380           00066         BCF     MULc,7
0500   1300           00067         BCF     MULc,6
0501   08??           00068         MOVF    ENR_12,W
0502   02??           00069         SUBWF   WARM_40,W
0503   00??           00070         MOVWF   MULp
0504   2???           00071         CALL    MUL8
0505   0D??           00072         RLF     L_byte,W
0506   0D??           00073         RLF     H_byte,W
0507   0D??           00074         RLF     H_byte,W
0508   07??           00075         ADDWF   ENR_12,W
0509   00??           00076         MOVWF   WARM_ENR
050A   2???           00077         GOTO    GO_MAP
                      00078 
                      00079 ; +20 to -12
                      00080 COLT_MID2       movab   COLT,MULc
050B   08??               M         movfw   COLT
050C   00??               M         movwf   MULc
050D   1380           00081         BCF     MULc,7
050E   1300           00082         BCF     MULc,6
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

050F   08??           00083         MOVF    WARM_20,W
0510   02??           00084         SUBWF   ENR_12,W
0511   00??           00085         MOVWF   MULp
0512   2???           00086         CALL    MUL8    
0513   0D??           00087         RLF     L_byte,F
0514   0D??           00088         RLF     H_byte,F
0515   0D??           00089         RLF     L_byte,F
0516   0D??           00090         RLF     H_byte,W
0517   07??           00091         ADDWF   WARM_20,W
0518   00??           00092         MOVWF   WARM_ENR
0519   2???           00093         GOTO    GO_MAP
                      00094 ; UP +20
051A   1F00           00095 COLT_MID        BTFSS   COLT,6
051B   2???           00096         GOTO    COLT_MID3
                      00097 ; Up to +50
                      00098         movab   COLT,MULc
051C   08??               M         movfw   COLT
051D   00??               M         movwf   MULc
051E   1380           00099         BCF     MULc,7
051F   1300           00100         BCF     MULc,6
0520   08??           00101         MOVF    WARM_50,W
0521   02??           00102         SUBWF   WARM_20,W
0522   00??           00103         MOVWF   MULp
0523   2???           00104         CALL    MUL8
0524   0D??           00105         RLF     L_byte,F
0525   0D??           00106         RLF     H_byte,F
0526   0D??           00107         RLF     L_byte,F
0527   0D??           00108         RLF     H_byte,W
0528   07??           00109         ADDWF   WARM_50,W
0529   00??           00110         MOVWF   WARM_ENR
052A   2???           00111         GOTO    GO_MAP
                      00112 
                      00113 ; +50 to +80
                      00114 COLT_MID3       movab   COLT,MULc
052B   08??               M         movfw   COLT
052C   00??               M         movwf   MULc
052D   1380           00115         BCF     MULc,7
052E   1300           00116         BCF     MULc,6
052F   08??           00117         MOVF    WARM_80,W
0530   02??           00118         SUBWF   WARM_50,W
0531   00??           00119         MOVWF   MULp
0532   2???           00120         CALL    MUL8
0533   0D??           00121         RLF     L_byte,F
0534   0D??           00122         RLF     H_byte,F
0535   0D??           00123         RLF     L_byte,F
0536   0D??           00124         RLF     H_byte,W
0537   07??           00125         ADDWF   WARM_80,W
0538   00??           00126         MOVWF   WARM_ENR
                      00127 ;       CLRF    WARM_ENR
                      00128 ;}
                      00129 ;-------------------------------------------------------------
0539   0C??           00130 GO_MAP  RRF     WARM_ENR,F
053A   1780           00131         BSF     WARM_ENR,7      
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00132 ; Обогащение смеси после пуска двигателя
053B   1F80           00133         BTFSS   STAT,7          ; Проверка флага включения обогащения после старта
053C   2???           00134         GOTO    GET_ACCEL
053D   03??           00135         DECF    D_TPS,F
053E   1B80           00136         BTFSC   D_TPS,7
053F   2???           00137         GOTO    SPD_E
0540   1380           00138         BCF     STAT,7
                      00139 ; вычисление режима обогащения
0541   08??           00140 GET_ACCEL       MOVF    TPS1,W          ; Предыдущее ПДЗ
0542   02??           00141         SUBWF   TPS,W           ; Вычитаем из предыдущего положения ДЗ настоящее
0543   00??           00142         MOVWF   D_TPS1          ; сохраняем как дельту
                      00143 
0544   1C03           00144         BTFSS   STATUS,C                ; Проверяем на наличие ускорения
0545   2???           00145         GOTO    D_ACCL
                      00146 
0546   1903           00147         BTFSC   STATUS,Z                ; Проверяем на наличие ускорения
0547   2???           00148         GOTO    ACCL_END
                      00149 
0548   3C05           00150         SUBLW   ACL_THR         ; Вычитаем  дельту с порога ускорения
0549   1803           00151         BTFSC   STATUS,C                ; Проверяем порог ускорения
054A   2???           00152         GOTO    ACCL_END
                      00153 
054B   1003           00154         BCF     STATUS,C
054C   0C??           00155         RRF     D_TPS1,F                ; Поделить на 2 коэфф. обогащения
054D   1003           00156         BCF     STATUS,C
054E   0C??           00157         RRF     D_TPS1,F                ; Поделить на 2 коэфф. обогащения
                      00158 
054F   08??           00159         MOVF    D_TPS,W         ; текущее обогащение
0550   397F           00160         ANDLW   B'01111111'
0551   02??           00161         SUBWF   D_TPS1,W                ; вычитаем текущее обогащение из вычисленного
0552   1903           00162         BTFSC   STATUS,Z
0553   2???           00163         GOTO    $+5
0554   1C03           00164         BTFSS   STATUS,C                ; если текущее обогащение меньше вычисленного, то
0555   2???           00165         GOTO    $+3
0556   08??           00166         MOVF    D_TPS1,W
0557   00??           00167         MOVWF   D_TPS
                      00168         
0558   1686           00169 ACLEE   BSF     ACCEL           ; Вкл. светодиод акселерации
0559   1580           00170         BSF     STAT,3          ; Вкл. флаг акселерации
055A   1780           00171         BSF     D_TPS,7
055B   2???           00172         GOTO    SPD_E
                      00173 ; Подпрограмма обеднения смеси при сбрасывании тапка
055C   3CFF           00174 D_ACCL  SUBLW   0FFH
055D   3C80           00175         SUBLW   80H
055E   00??           00176         MOVWF   D_TPS
055F   1600           00177         BSF     STAT,4
0560   2???           00178         GOTO    SPD_E
                      00179 
0561   08??           00180 ACCL_END        MOVF    D_TPS,W
0562   1903           00181         BTFSC   STATUS,Z
0563   2???           00182         GOTO    $+4
0564   03??           00183         DECF    D_TPS,F
0565   1B80           00184         BTFSC   D_TPS,7
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0566   2???           00185         GOTO    ACLEE
                      00186 
0567   1286           00187         BCF     ACCEL
                      00188 ;       CLRF    D_TPS
0568   1180           00189         BCF     STAT,3
0569   1200           00190         BCF     STAT,4
                      00191 ; Обработка таблицы объёмной эффективности в зависимости от оборотов двигателя
                      00192 SPD_E   movab   SPD,TEMP
056A   08??               M         movfw   SPD
056B   00??               M         movwf   TEMP
056C   2???           00193         CALL    READ_STR
056D   00??           00194         MOVWF   SPD_ENR
056E   ???? ????      00195         PAGESEL SPD_E   
                      00196 ; SPD_ENR=(обог%)/100*256
                      00197 ; Обогащение по скорости=SPD_ENR/256*100
                      00198 IFDEF ECON_CORR
                      00199 ; Экономайзер тапки в пол Основная смесь - 12,5
0570   08??           00200         MOVF    TPS,W   
0571   3CCC           00201         SUBLW   0CCH            ; Порог 4.5v
0572   1803           00202         BTFSC   STATUS,C
0573   2???           00203         GOTO    TR_EN
0574   1880           00204         BTFSC   STAT,1          ; Проверка флага прогрева двигателя
0575   2???           00205         GOTO    TR_EN
0576   3064           00206         MOVLW   D'100'          ; Нижний порог оборотов 2500
0577   02??           00207         SUBWF   SPD,W
0578   1C03           00208         BTFSS   STATUS,C
0579   2???           00209         GOTO    TR_EN
                      00210         let     Mul1Lo,0B3H             ;  1.339
057A   30B3               M         movlw   0B3H
057B   00??               M         movwf   Mul1Lo
                      00211         let     Mul1Hi,0H
057C   3000               M         movlw   0H
057D   00??               M         movwf   Mul1Hi
057E   2???           00212         GOTO    MUL_ENR
                      00213 ; Экономайзер мощностных режимов Основная смесь - 13,5
057F   08??           00214 TR_EN   MOVF    MAP,W   
0580   3C99           00215         SUBLW   099H            ; Порог 80H-60KPa, 99H-70KPa, B3H-80KPa, BD-85KPa
0581   1803           00216         BTFSC   STATUS,C                ; 
0582   2???           00217         GOTO    EMR_OFF
                      00218         let     Mul1Lo,09DH             ; 1.244*127
0583   309D               M         movlw   09DH
0584   00??               M         movwf   Mul1Lo
                      00219         let     Mul1Hi,0H
0585   3000               M         movlw   0H
0586   00??               M         movwf   Mul1Hi
                      00220         
0587   1686           00221 MUL_ENR BSF     ACCEL
0588   1700           00222         BSF     STAT,6
0589   08??           00223         MOVF    SPD_ENR,W
058A   00??           00224         MOVWF   MULc
058B   2???           00225         CALL    MUL16_8
058C   0D??           00226         RLF     Mul1Lo,W                ; Помещаем бит 7 в С
058D   0D??           00227         RLF     Mul1Hi,W                ; Перемещаем карри в 1 бит
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

058E   00??           00228         MOVWF   SPD_ENR
058F   2???           00229         GOTO    ECON
                      00230 ENDIF
0590   1300           00231 EMR_OFF BCF     STAT,6
                      00232 ;-----------------------------------------------------
                      00233 
                      00234 
                      00235 
                      00236 ;-----------------------------------------------------
                      00237 ;  ЭКОНОМАЙЗЕР ПРИНУДИТЕЛЬНОГО ХОЛОСТОГО ХОДА
                      00238 ;{-----------------------------------------------------
0591   1F80           00239 ECON    BTFSS   STAT,7  
0592   1D00           00240         BTFSS   STAT,2          ; Проверка холостого хода
0593   2???           00241         GOTO    Ln_Int
                      00242 ; Добавил для устранения подёргивания на прогреве и ухода в ЭПХХ
0594   1B80           00243         BTFSC   COLT,7
0595   2???           00244         GOTO    Ln_Int
                      00245 
                      00246 
                      00247 
0596   1A80           00248         BTFSC   STAT,5          ; Проверка 
0597   2???           00249         GOTO    $+9     
0598   08??           00250         MOVF    SPD,W           ; Верхний порог оборотов        
0599   3C44           00251         SUBLW   (SPD_EPHH/.25)+4
059A   1803           00252         BTFSC   STATUS,C        
059B   2???           00253         GOTO    Ln_Int
059C   1680           00254         BSF     STAT,5          ; Ставим бит включённого экономайзера
059D   01??           00255         CLRF    T_INJ_H
059E   01??           00256         CLRF    T_INJ_L
059F   2???           00257         GOTO    EXT
                      00258 
05A0   303F           00259         MOVLW   (SPD_EPHH/.25)-1                ; Нижний порог оборотов
05A1   02??           00260         SUBWF   SPD,W
05A2   1C03           00261         BTFSS   STATUS,C
05A3   2???           00262         GOTO    Ln_Int
05A4   01??           00263         CLRF    T_INJ_H
05A5   01??           00264         CLRF    T_INJ_L
05A6   2???           00265         GOTO    EXT
                      00266 ;}
                      00267 ;-----------------------------------------------------
                      00268 ;  ЛИНЕЙНАЯ ИНТЕРПОЛЯЦИЯ ВЫЧИСЛЕНИЯ ВРЕМЕНИ ВПРЫСКА
                      00269 ;{-----------------------------------------------------
05A7   1280           00270 Ln_Int  BCF     STAT,5
                      00271 IFNDEF LineIntFuelEqual
                      00272 ; Выравнивание для датчика MPX4100AP
                      00273 ; Pres=(MAP+Offcet)*Slope/256 
05A8   1100           00274         BCF     Flag_Math,2
05A9   01??           00275         CLRF    Mul1Hi
05AA   3026           00276         MOVLW   OFFSET  ;Добавка для выравнивания характеристики ДАД
05AB   07??           00277         ADDWF   MAP,W
05AC   1803 0A??      00278         ADDCF   Mul1Hi,F
05AE   00??           00279         MOVWF   Mul1Lo          ; Mul1=(MAP+Offset)
                      00280         let     MULc,SLOPE      ; Наклон характеристики ДАД
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05AF   30F2               M         movlw   .242
05B0   00??               M         movwf   MULc
05B1   2???           00281         CALL    MUL16_8         ; Умножение 16х8
05B2   08??           00282         TSTF    ResHi
                      00283 ;       SKPZ
                      00284 ;       BSF     Flag_Math,2     
05B3   1903           00285         SKPNZ
05B4   2???           00286         GOTO    $+3
                      00287         let     Mul1Hi,0FFH
05B5   30FF               M         movlw   0FFH
05B6   00??               M         movwf   Mul1Hi
                      00288         movab   Mul1Hi,MULc             ; Выравненное значение в MULc
05B7   08??               M         movfw   Mul1Hi
05B8   00??               M         movwf   MULc
                      00289 movab Mul1Hi,UOZ
05B9   08??               M         movfw   Mul1Hi
05BA   00??               M         movwf   UOZ
05BB   08??           00290         MOVF    RqFl,W
05BC   00??           00291         MOVWF   Mul1Lo          ; MULp=low RqF
05BD   08??           00292         MOVF    RqFh,W
05BE   00??           00293         MOVWF   Mul1Hi          ; MULp=high RqF
                      00294 
05BF   2???           00295         CALL    MUL16_8         ; Умножение 16х8
                      00296 
                      00297 ;       BTFSS   Flag_Math,2             ; Домножаем на старшый бит 255
                      00298 ;       GOTO    Sreslt
                      00299 
                      00300 ;       MOVF    Mul1Lo,W                ; СОХРАНЕНИЕ РЕГИСТРОВ
                      00301 ;       banksel TEMP_MULT
                      00302 ;       MOVWF   TEMP_MULT
                      00303 ;       bank0
                      00304 ;       MOVF    Mul1Hi,W
                      00305 ;       banksel TEMP_MULT
                      00306 ;       MOVWF   TEMP_MULT+1
                      00307 ;       bank0
                      00308 ;       MOVF    ResHi,W
                      00309 ;       banksel TEMP_MULT
                      00310 ;       MOVWF   TEMP_MULT+2
                      00311 ;       bank0
                      00312 ;       MOVLW   0FFH
                      00313 ;       MOVWF   MULc
                      00314 ;       MOVF    RqFl,W
                      00315 ;       MOVWF   Mul1Lo          ; MULp=low RqF
                      00316 ;       MOVF    RqFh,W
                      00317 ;       MOVWF   Mul1Hi          ; MULp=high RqF
                      00318 ;
                      00319 ;       CALL    MUL16_8         ; Умножение 16х8
                      00320 ;
                      00321 ;       MOVF    Mul1Lo,W                ; СЛОЖЕНИЕ С СОХРАНЁННЫМИ РЕГИСТРАМИ
                      00322 ;       banksel TEMP_MULT
                      00323 ;       ADDWF   TEMP_MULT,W
                      00324 ;       bank0
                      00325 ;       MOVWF   Mul1Lo
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00326 ;
                      00327 ;       BTFSS   STATUS,C
                      00328 ;       GOTO    $+3
                      00329 ;       MOVLW   .1      
                      00330 ;       ADDWF   Mul1Hi,F
                      00331 
                      00332 ;       BTFSC   STATUS,C
                      00333 ;       INCF    ResHi,F
                      00334 
                      00335 ;       MOVF    Mul1Hi,W
                      00336 ;       banksel TEMP_MULT
                      00337 ;       ADDWF   TEMP_MULT+1,W
                      00338 ;       bank0
                      00339 ;       MOVWF   Mul1Hi
                      00340 
                      00341 ;       BTFSC   STATUS,C
                      00342 ;       INCF    ResHi,F
                      00343 ;       MOVF    ResHi,W
                      00344 ;       banksel TEMP_MULT
                      00345 ;       ADDWF   TEMP_MULT+2,W
                      00346 ;       bank0
                      00347 ;       MOVWF   ResHi
                      00348 
                      00349 
                      00350 
05C0   08??           00351 Sreslt  MOVF    Mul1Hi,W
05C1   00??           00352         MOVWF   T_INJ_L
05C2   08??           00353         MOVF    ResHi,W
05C3   00??           00354         MOVWF   T_INJ_H
                      00355 
05C4                  00356 EqlOut
                      00357 ENDIF
                      00358 IFDEF LineIntFuelEqual
                      00359         MOVF    MAP,W
                      00360         MOVWF   MULc            ; MULc=MAP
                      00361 
                      00362         CLRF    Mul1Hi
                      00363         MOVF    RCOl,W
                      00364         SUBWF   RqFl,W
                      00365         MOVWF   Mul1Lo          ; MULp=low (RqF-RCO)
                      00366         BTFSC   STATUS,C
                      00367 ;-- тут ошибка
                      00368         DECF    Mul1Hi,F
                      00369 ;---
                      00370         MOVF    RCOl,W
                      00371         SUBWF   RqFh,W
                      00372         MOVWF   Mul1Hi          ; MULp=high (RqF-RCO)
                      00373 
                      00374         CALL    MUL16_8         ; Умножение 16х8
                      00375         MOVF    Mul1Hi,W
                      00376         ADDWF   RCOl,W
                      00377         MOVWF   T_INJ_L
                      00378         BTFSC   STATUS,C
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00379         INCF    ResHi,F
                      00380         MOVF    ResHi,W
                      00381         ADDWF   RCOh,W
                      00382         MOVWF   T_INJ_H
                      00383 ENDIF
                      00384 ;}
                      00385 ; Выбор канала АЦП ДПДЗ
                      00386 ;       let     ADCON0,ADC_TPS  ; AN0 TPS
                      00387 ; Корректировка смеси в зависимости от оборотов
                      00388         movab   SPD_ENR,MULc
05C4   08??               M         movfw   SPD_ENR
05C5   00??               M         movwf   MULc
                      00389         movab   T_INJ_L,Mul1Lo
05C6   08??               M         movfw   T_INJ_L
05C7   00??               M         movwf   Mul1Lo
                      00390         movab   T_INJ_H,Mul1Hi
05C8   08??               M         movfw   T_INJ_H
05C9   00??               M         movwf   Mul1Hi
05CA   2???           00391         CALL    MUL16_8         ; Умножение 16х8
05CB   0D??           00392         RLF     Mul1Lo,W
05CC   0D??           00393         RLF     Mul1Hi,W
05CD   08??           00394         MOVF    Mul1Hi,W
                      00395 IFDEF VE_CORR
05CE   00??           00396         MOVWF   T_INJ_L
05CF   0D??           00397         RLF     ResHi,W
05D0   08??           00398         MOVF    ResHi,W
05D1   00??           00399         MOVWF   T_INJ_H
                      00400 ENDIF
05D2   1C80           00401         BTFSS   STAT,1          ; Проверка флага прогрева двигателя
05D3   2???           00402         GOTO    ACCL
                      00403         
                      00404 
05D4                  00405 Warm_Enr        ;RRF    WARM_ENR,F
                      00406         ;BSF    WARM_ENR,7
                      00407         movab   WARM_ENR,MULc
05D4   08??               M         movfw   WARM_ENR
05D5   00??               M         movwf   MULc
                      00408 
                      00409         movab   T_INJ_L,Mul1Lo
05D6   08??               M         movfw   T_INJ_L
05D7   00??               M         movwf   Mul1Lo
                      00410         movab   T_INJ_H,Mul1Hi
05D8   08??               M         movfw   T_INJ_H
05D9   00??               M         movwf   Mul1Hi
05DA   2???           00411         CALL    MUL16_8         ; Умножение 16х8
                      00412 IFDEF WARM_CORR
05DB   0D??           00413         RLF     Mul1Lo,W
05DC   0D??           00414         RLF     Mul1Hi,W
05DD   00??           00415         MOVWF   T_INJ_L
05DE   0D??           00416         RLF     ResHi,W
05DF   00??           00417         MOVWF   T_INJ_H
                      00418 ENDIF
                      00419 ; Програмный модуль вычисления обогащения
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05E0   1B80           00420 ACCL    BTFSC   STAT,7  
05E1   2???           00421         GOTO    Corr
                      00422 IFDEF ACCEL_CORR
05E2   1D80           00423         BTFSS   STAT,3
05E3   1A00           00424         BTFSC   STAT,4
05E4   2???           00425         GOTO    $+2
                      00426 ENDIF
05E5   2???           00427         GOTO    EXT2
                      00428 Corr    movab   D_TPS,MULc
05E6   08??               M         movfw   D_TPS
05E7   00??               M         movwf   MULc
                      00429         movab   T_INJ_L,Mul1Lo
05E8   08??               M         movfw   T_INJ_L
05E9   00??               M         movwf   Mul1Lo
                      00430         movab   T_INJ_H,Mul1Hi
05EA   08??               M         movfw   T_INJ_H
05EB   00??               M         movwf   Mul1Hi
05EC   2???           00431         CALL    MUL16_8         ; Умножение 16х8
05ED   0D??           00432         RLF     Mul1Lo,W
05EE   0D??           00433         RLF     Mul1Hi,W
                      00434 
05EF   00??           00435         MOVWF   T_INJ_L
05F0   0D??           00436         RLF     ResHi,W
05F1   00??           00437         MOVWF   T_INJ_H
                      00438 
                      00439 ; запуск вычисления АЦП ДПДЗ
05F2   1280           00440 EXT2    BCF     STAT,5
                      00441 ;       BSF     ADCON0,GO
                      00442 ;       RETURN
                      00443 ; Выход в режиме экономайзера ПХХ
                      00444 EXT     let     ADCON0,ADC_TPS
05F3   3089               M         movlw   b'10001001'
05F4   009F               M         movwf   ADCON0
05F5   2???           00445         CALL    DELEY20
05F6   151F           00446         BSF     ADCON0,GO
05F7   0008           00447         RETURN
                      00999         #include MUL16x8.asm
                      00001 ;       list      p=16f628A           ; list directive to define processor
                      00002 ;       #include <p16F628A.inc>       ; processor specific variable definitions
                      00003 ;       errorlevel  -302              ; suppress message 302 from list file
                      00004 
                      00005 ;-------------------------------------------------------------------------------------------------------
                            ------
                      00006 ;П/п перемножения 16х8. Операнды находятся в Mul1Lo,Mul1Hi и MULc
                      00007 ;Результат помещается в Mul1Lo, Mul1Hi, ResHi.
                      00008 ;Продолжительность до 200 циклов.
                      00009 #define Tmp2    Flag_Math,1
05F8                  00010 MUL16_8 
05F8   01??           00011         clrf Temp6
05F9   01??           00012         clrf Temp7
05FA   01??           00013         clrf Temp8
05FB   01??           00014         clrf Temp9
05FC   01??           00015         clrf ResHi
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05FD   3008           00016         movlw 8
05FE   00??           00017         movwf Cnt
05FF                  00018 Ml_3
05FF   0C??           00019         rrf MULc,1
0600   1C03           00020         btfss STATUS,C
0601   2???           00021         goto Ml_5
0602   08??           00022         movf Mul1Lo,0
0603   07??           00023         addwf Temp7,1
0604   1C03           00024         btfss  STATUS,C
0605   2???           00025         goto Ml_1
0606   0F??           00026         incfsz Temp8,1
0607   2???           00027         goto Ml_1
0608   0A??           00028         incf ResHi,1
                      00029         
0609                  00030 Ml_1
0609   08??           00031         movf Mul1Hi,0
060A   07??           00032         addwf Temp8,1
060B   1C03           00033         btfss  STATUS,C
060C   2???           00034         goto Ml_2
060D   0A??           00035         incf ResHi,1
                      00036         
060E   08??           00037 Ml_2    movf Temp6,0
060F   07??           00038         addwf ResHi,1
0610                  00039 Ml_5
0610   0B??           00040         decfsz Cnt,1
0611   2???           00041         goto Ml_4
0612   2???           00042         goto Fin_Mul
                      00043 
0613   1003           00044 Ml_4    bcf STATUS,C
0614   0D??           00045         rlf Mul1Lo,1
0615   0D??           00046         rlf Mul1Hi,1
0616   0D??           00047         rlf Temp6,1
0617   2???           00048         goto Ml_3       
0618                  00049 Fin_Mul
0618   08??           00050         movf Temp7,0
0619   00??           00051         movwf Mul1Lo
061A   08??           00052         movf Temp8,0
061B   00??           00053         movwf Mul1Hi
061C   0008           00054         return
                      00055 
                      00056 
                      00057 
                      00058 
061D                  00059 Sub_
061D   1080           00060         bcf Tmp2
061E   08??           00061         movf DivLo,0            
061F   02??           00062         Subwf Temp6,1           
0620   1803           00063         btfsc STATUS,C          
0621   2???           00064         goto Subnd              
0622   03??           00065         decf Temp8,1            
0623   30FF           00066         movlw 0xff              
0624   02??           00067         Subwf Temp8,0           
0625   1D03           00068         btfss STATUS,Z          
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0626   2???           00069         goto Subnd              
0627   03??           00070         decf Temp9,1            
0628   30FF           00071         movlw 0xff              
0629   02??           00072         Subwf Temp9,0           
062A   1903           00073         btfsc STATUS,Z          
062B   1480           00074         bsf Tmp2                        
                      00075 
                      00076 
062C                  00077 Subnd
062C   08??           00078         movf DivHi,0
062D   02??           00079         Subwf Temp8,1
062E   1803           00080         btfsc STATUS,C
062F   0008           00081         return
0630   03??           00082         decf Temp9,1
0631   30FF           00083         movlw 0xff
0632   02??           00084         Subwf Temp9,0
0633   1903           00085         btfsc STATUS,Z
0634   1480           00086         bsf Tmp2
0635   0008           00087         return
                      01000 
                      01001 ;       #include pwl.asm
                      01002         #include VE.asm
                      00001 ;-----------------------------------------------------
                      00002 ; ПОДПРОГРАММА ЧТЕНИЯ ТАБЛИЦЫ ОБЪЁМНОЙ ЭФФЕКТИВНОСТИ
                      00003 ;-----------------------------------------------------
                      00004         ORG     800;-4
0800                  00005 EngSC;  MOVLW   D'6'
                      00006 ;       MOVWF   PCLATH
                      00007 ;       MOVFW   SPD
                      00008 ;       MOVWF   PCL
                      00009 ; Начало таблицы
0800   3490           00010         RETLW    0X90           ; 0 ,об/мин 0%
0801   349F           00011         RETLW    0X9F   ;       ; 25об/мин  62,2%
0802   349F           00012         RETLW    0X9F   ;       ; 50об/мин  62,2%
0803   349F           00013         RETLW    0X9F   ;       ; 75об/мин  62,2%
0804   349F           00014         RETLW    0X9F   ;       ; 100об/мин  62,2%
0805   349F           00015         RETLW    0X9F   ;       ; 125об/мин  62,2%
0806   349F           00016         RETLW    0X9F   ;       ; 150об/мин  62,2%
0807   349F           00017         RETLW    0X9F   ;       ; 175об/мин  62,2%
0808   349F           00018         RETLW    0X9F   ;       ; 200об/мин  62,2%
0809   349F           00019         RETLW    0X9F   ;       ; 225об/мин  62,2%
080A   349F           00020         RETLW    0X9F   ;       ; 250об/мин  62,2%
080B   349F           00021         RETLW    0X9F   ;       ; 275об/мин  62,2%
080C   349F           00022         RETLW    0X9F   ;       ; 300об/мин  62,2%
080D   349F           00023         RETLW    0X9F   ;       ; 325об/мин  62,2%
080E   349F           00024         RETLW    0X9F   ;       ; 350об/мин  62,2%
080F   349F           00025         RETLW    0X9F   ;       ; 375об/мин  62,2%
0810   349F           00026         RETLW    0X9F   ;       ; 400об/мин  62,2%
0811   34A1           00027         RETLW    0XA1   ;       ; 425об/мин  62,875%
0812   34A3           00028         RETLW    0XA3   ;       ; 450об/мин  63,55%
0813   34A4           00029         RETLW    0XA4   ;       ; 475об/мин  64,225%
0814   34A6           00030         RETLW    0XA6   ;       ; 500об/мин  64,9%
0815   34A8           00031         RETLW    0XA8   ;       ; 525об/мин  65,575%
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0816   34AA           00032         RETLW    0XAA   ;       ; 550об/мин  66,25%
0817   34AB           00033         RETLW    0XAB   ;       ; 575об/мин  66,925%
0818   34AD           00034         RETLW    0XAD   ;       ; 600об/мин  67,6%
0819   34AD           00035         RETLW    0XAD   ;       ; 625об/мин  67,615%
081A   34AD           00036         RETLW    0XAD   ;       ; 650об/мин  67,63%
081B   34AD           00037         RETLW    0XAD   ;       ; 675об/мин  67,645%
081C   34AD           00038         RETLW    0XAD   ;       ; 700об/мин  67,66%
081D   34AD           00039         RETLW    0XAD   ;       ; 725об/мин  67,675%
081E   34AD           00040         RETLW    0XAD   ;       ; 750об/мин  67,69%
081F   34AD           00041         RETLW    0XAD   ;       ; 775об/мин  67,705%
0820   34AD           00042         RETLW    0XAD   ;       ; 800об/мин  67,72%
0821   34AD           00043         RETLW    0XAD   ;       ; 825об/мин  67,735%
0822   34AD           00044         RETLW    0XAD   ;       ; 850об/мин  67,75%
0823   34AD           00045         RETLW    0XAD   ;       ; 875об/мин  67,765%
0824   34AE           00046         RETLW    0XAE   ;       ; 900об/мин  67,78%
0825   34AE           00047         RETLW    0XAE   ;       ; 925об/мин  67,795%
0826   34AE           00048         RETLW    0XAE   ;       ; 950об/мин  67,81%
0827   34AE           00049         RETLW    0XAE   ;       ; 975об/мин  67,825%
0828   34AE           00050         RETLW    0XAE   ;       ; 1000об/мин  67,84%
0829   34AE           00051         RETLW    0XAE   ;       ; 1025об/мин  67,855%
082A   34AE           00052         RETLW    0XAE   ;       ; 1050об/мин  67,87%
082B   34AE           00053         RETLW    0XAE   ;       ; 1075об/мин  67,885%
082C   34AE           00054         RETLW    0XAE   ;       ; 1100об/мин  67,9%
082D   34AE           00055         RETLW    0XAE   ;       ; 1125об/мин  67,91%
082E   34AE           00056         RETLW    0XAE   ;       ; 1150об/мин  67,91%
082F   34AE           00057         RETLW    0XAE   ;       ; 1175об/мин  67,92%
0830   34AE           00058         RETLW    0XAE   ;       ; 1200об/мин  67,92%
0831   34AE           00059         RETLW    0XAE   ;       ; 1225об/мин  67,93%
0832   34AE           00060         RETLW    0XAE   ;       ; 1250об/мин  67,93%
0833   34AE           00061         RETLW    0XAE   ;       ; 1275об/мин  67,94%
0834   34AE           00062         RETLW    0XAE   ;       ; 1300об/мин  67,94%
0835   34AE           00063         RETLW    0XAE   ;       ; 1325об/мин  67,95%
0836   34AE           00064         RETLW    0XAE   ;       ; 1350об/мин  67,95%
0837   34AE           00065         RETLW    0XAE   ;       ; 1375об/мин  67,96%
0838   34AE           00066         RETLW    0XAE   ;       ; 1400об/мин  67,96%
0839   34AE           00067         RETLW    0XAE   ;       ; 1425об/мин  67,97%
083A   34AE           00068         RETLW    0XAE   ;       ; 1450об/мин  67,97%
083B   34AE           00069         RETLW    0XAE   ;       ; 1475об/мин  67,98%
083C   34AE           00070         RETLW    0XAE   ;       ; 1500об/мин  67,98%
083D   34AE           00071         RETLW    0XAE   ;       ; 1525об/мин  67,99%
083E   34AE           00072         RETLW    0XAE   ;       ; 1550об/мин  67,99%
083F   34AE           00073         RETLW    0XAE   ;       ; 1575об/мин  68%
0840   34AE           00074         RETLW    0XAE   ;       ; 1600об/мин  68%
0841   34AE           00075         RETLW    0XAE   ;       ; 1625об/мин  68,1%
0842   34AF           00076         RETLW    0XAF   ;       ; 1650об/мин  68,2%
0843   34AF           00077         RETLW    0XAF   ;       ; 1675об/мин  68,3%
0844   34AF           00078         RETLW    0XAF   ;       ; 1700об/мин  68,4%
0845   34AF           00079         RETLW    0XAF   ;       ; 1725об/мин  68,5%
0846   34AF           00080         RETLW    0XAF   ;       ; 1750об/мин  68,5%
0847   34B0           00081         RETLW    0XB0   ;       ; 1775об/мин  68,6%
0848   34B0           00082         RETLW    0XB0   ;       ; 1800об/мин  68,7%
0849   34B0           00083         RETLW    0XB0   ;       ; 1825об/мин  68,8%
084A   34B0           00084         RETLW    0XB0   ;       ; 1850об/мин  68,9%
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

084B   34B1           00085         RETLW    0XB1   ;       ; 1875об/мин  69%
084C   34B1           00086         RETLW    0XB1   ;       ; 1900об/мин  69,1%
084D   34B1           00087         RETLW    0XB1   ;       ; 1925об/мин  69,2%
084E   34B1           00088         RETLW    0XB1   ;       ; 1950об/мин  69,3%
084F   34B2           00089         RETLW    0XB2   ;       ; 1975об/мин  69,4%
0850   34B2           00090         RETLW    0XB2   ;       ; 2000об/мин  69,5%
0851   34B2           00091         RETLW    0XB2   ;       ; 2025об/мин  69,5%
0852   34B2           00092         RETLW    0XB2   ;       ; 2050об/мин  69,6%
0853   34B2           00093         RETLW    0XB2   ;       ; 2075об/мин  69,7%
0854   34B3           00094         RETLW    0XB3   ;       ; 2100об/мин  69,8%
0855   34B3           00095         RETLW    0XB3   ;       ; 2125об/мин  69,9%
0856   34B3           00096         RETLW    0XB3   ;       ; 2150об/мин  70%
0857   34B3           00097         RETLW    0XB3   ;       ; 2175об/мин  70,1%
0858   34B4           00098         RETLW    0XB4   ;       ; 2200об/мин  70,2%
0859   34B4           00099         RETLW    0XB4   ;       ; 2225об/мин  70,3%
085A   34B4           00100         RETLW    0XB4   ;       ; 2250об/мин  70,5%
085B   34B5           00101         RETLW    0XB5   ;       ; 2275об/мин  70,7%
085C   34B5           00102         RETLW    0XB5   ;       ; 2300об/мин  70,8%
085D   34B6           00103         RETLW    0XB6   ;       ; 2325об/мин  71%
085E   34B6           00104         RETLW    0XB6   ;       ; 2350об/мин  71,1%
085F   34B7           00105         RETLW    0XB7   ;       ; 2375об/мин  71,3%
0860   34B7           00106         RETLW    0XB7   ;       ; 2400об/мин  71,4%
0861   34B7           00107         RETLW    0XB7   ;       ; 2425об/мин  71,6%
0862   34B8           00108         RETLW    0XB8   ;       ; 2450об/мин  71,8%
0863   34B8           00109         RETLW    0XB8   ;       ; 2475об/мин  71,9%
0864   34B9           00110         RETLW    0XB9   ;       ; 2500об/мин  72,1%
0865   34B9           00111         RETLW    0XB9   ;       ; 2525об/мин  72,2%
0866   34B9           00112         RETLW    0XB9   ;       ; 2550об/мин  72,4%
0867   34BA           00113         RETLW    0XBA   ;       ; 2575об/мин  72,6%
0868   34BA           00114         RETLW    0XBA   ;       ; 2600об/мин  72,7%
0869   34BB           00115         RETLW    0XBB   ;       ; 2625об/мин  72,9%
086A   34BB           00116         RETLW    0XBB   ;       ; 2650об/мин  73%
086B   34BB           00117         RETLW    0XBB   ;       ; 2675об/мин  73,2%
086C   34BC           00118         RETLW    0XBC   ;       ; 2700об/мин  73,3%
086D   34BC           00119         RETLW    0XBC   ;       ; 2725об/мин  73,5%
086E   34BD           00120         RETLW    0XBD   ;       ; 2750об/мин  73,7%
086F   34BD           00121         RETLW    0XBD   ;       ; 2775об/мин  73,8%
0870   34BD           00122         RETLW    0XBD   ;       ; 2800об/мин  74%
0871   34BE           00123         RETLW    0XBE   ;       ; 2825об/мин  74,1%
0872   34BE           00124         RETLW    0XBE   ;       ; 2850об/мин  74,1%
0873   34BE           00125         RETLW    0XBE   ;       ; 2875об/мин  74,2%
0874   34BE           00126         RETLW    0XBE   ;       ; 2900об/мин  74,3%
0875   34BE           00127         RETLW    0XBE   ;       ; 2925об/мин  74,4%
0876   34BE           00128         RETLW    0XBE   ;       ; 2950об/мин  74,4%
0877   34BF           00129         RETLW    0XBF   ;       ; 2975об/мин  74,5%
0878   34BF           00130         RETLW    0XBF   ;       ; 3000об/мин  74,6%
0879   34BF           00131         RETLW    0XBF   ;       ; 3025об/мин  74,7%
087A   34BF           00132         RETLW    0XBF   ;       ; 3050об/мин  74,8%
087B   34BF           00133         RETLW    0XBF   ;       ; 3075об/мин  74,8%
087C   34C0           00134         RETLW    0XC0   ;       ; 3100об/мин  74,9%
087D   34C0           00135         RETLW    0XC0   ;       ; 3125об/мин  75%
087E   34C0           00136         RETLW    0XC0   ;       ; 3150об/мин  75,1%
087F   34C1           00137         RETLW    0XC1   ;       ; 3175об/мин  75,2%
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0880   34C1           00138         RETLW    0XC1   ;       ; 3200об/мин  75,2%
0881   34C1           00139         RETLW    0XC1   ;       ; 3225об/мин  75,3%
0882   34C1           00140         RETLW    0XC1   ;       ; 3250об/мин  75,4%
0883   34C1           00141         RETLW    0XC1   ;       ; 3275об/мин  75,5%
0884   34C2           00142         RETLW    0XC2   ;       ; 3300об/мин  75,6%
0885   34C2           00143         RETLW    0XC2   ;       ; 3325об/мин  75,6%
0886   34C2           00144         RETLW    0XC2   ;       ; 3350об/мин  75,7%
0887   34C2           00145         RETLW    0XC2   ;       ; 3375об/мин  75,8%
0888   34C2           00146         RETLW    0XC2   ;       ; 3400об/мин  75,9%
0889   34C2           00147         RETLW    0XC2   ;       ; 3425об/мин  75,9%
088A   34C2           00148         RETLW    0XC2   ;       ; 3450об/мин  75,9%
088B   34C2           00149         RETLW    0XC2   ;       ; 3475об/мин  75,9%
088C   34C2           00150         RETLW    0XC2   ;       ; 3500об/мин  75,9%
088D   34C2           00151         RETLW    0XC2   ;       ; 3525об/мин  75,9%
088E   34C2           00152         RETLW    0XC2   ;       ; 3550об/мин  75,9%
088F   34C2           00153         RETLW    0XC2   ;       ; 3575об/мин  75,9%
0890   34C2           00154         RETLW    0XC2   ;       ; 3600об/мин  75,9%
0891   34C2           00155         RETLW    0XC2   ;       ; 3625об/мин  75,9%
0892   34C2           00156         RETLW    0XC2   ;       ; 3650об/мин  75,9%
0893   34C2           00157         RETLW    0XC2   ;       ; 3675об/мин  75,9%
0894   34C2           00158         RETLW    0XC2   ;       ; 3700об/мин  75,9%
0895   34C2           00159         RETLW    0XC2   ;       ; 3725об/мин  75,9%
0896   34C2           00160         RETLW    0XC2   ;       ; 3750об/мин  75,9%
0897   34C2           00161         RETLW    0XC2   ;       ; 3775об/мин  75,9%
0898   34C2           00162         RETLW    0XC2   ;       ; 3800об/мин  75,9%
0899   34C2           00163         RETLW    0XC2   ;       ; 3825об/мин  75,9%
089A   34C2           00164         RETLW    0XC2   ;       ; 3850об/мин  75,9%
089B   34C2           00165         RETLW    0XC2   ;       ; 3875об/мин  75,9%
089C   34C2           00166         RETLW    0XC2   ;       ; 3900об/мин  75,9%
089D   34C2           00167         RETLW    0XC2   ;       ; 3925об/мин  75,9%
089E   34C2           00168         RETLW    0XC2   ;       ; 3950об/мин  75,9%
089F   34C2           00169         RETLW    0XC2   ;       ; 3975об/мин  75,9%
08A0   34C2           00170         RETLW    0XC2   ;       ; 4000об/мин  75,9%
08A1   34C2           00171         RETLW    0XC2   ;       ; 4025об/мин  75,9%
08A2   34C2           00172         RETLW    0XC2   ;       ; 4050об/мин  75,9%
08A3   34C2           00173         RETLW    0XC2   ;       ; 4075об/мин  75,9%
08A4   34C2           00174         RETLW    0XC2   ;       ; 4100об/мин  75,9%
08A5   34C2           00175         RETLW    0XC2   ;       ; 4125об/мин  75,9%
08A6   34C2           00176         RETLW    0XC2   ;       ; 4150об/мин  75,9%
08A7   34C2           00177         RETLW    0XC2   ;       ; 4175об/мин  75,9%
08A8   34C2           00178         RETLW    0XC2   ;       ; 4200об/мин  75,9%
08A9   34C2           00179         RETLW    0XC2   ;       ; 4225об/мин  75,9%
08AA   34C2           00180         RETLW    0XC2   ;       ; 4250об/мин  75,9%
08AB   34C2           00181         RETLW    0XC2   ;       ; 4275об/мин  75,9%
08AC   34C2           00182         RETLW    0XC2   ;       ; 4300об/мин  75,9%
08AD   34C2           00183         RETLW    0XC2   ;       ; 4325об/мин  75,9%
08AE   34C2           00184         RETLW    0XC2   ;       ; 4350об/мин  75,9%
08AF   34C2           00185         RETLW    0XC2   ;       ; 4375об/мин  75,9%
08B0   34C2           00186         RETLW    0XC2   ;       ; 4400об/мин  75,9%
08B1   34C2           00187         RETLW    0XC2   ;       ; 4425об/мин  75,9%
08B2   34C2           00188         RETLW    0XC2   ;       ; 4450об/мин  75,9%
08B3   34C2           00189         RETLW    0XC2   ;       ; 4475об/мин  75,9%
08B4   34C2           00190         RETLW    0XC2   ;       ; 4500об/мин  75,9%
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

08B5   34C2           00191         RETLW    0XC2   ;       ; 4525об/мин  75,9%
08B6   34C2           00192         RETLW    0XC2   ;       ; 4550об/мин  75,9%
08B7   34C2           00193         RETLW    0XC2   ;       ; 4575об/мин  75,9%
08B8   34C2           00194         RETLW    0XC2   ;       ; 4600об/мин  75,9%
08B9   34C2           00195         RETLW    0XC2   ;       ; 4625об/мин  75,8%
08BA   34C2           00196         RETLW    0XC2   ;       ; 4650об/мин  75,8%
08BB   34C2           00197         RETLW    0XC2   ;       ; 4675об/мин  75,8%
08BC   34C2           00198         RETLW    0XC2   ;       ; 4700об/мин  75,7%
08BD   34C2           00199         RETLW    0XC2   ;       ; 4725об/мин  75,7%
08BE   34C2           00200         RETLW    0XC2   ;       ; 4750об/мин  75,6%
08BF   34C2           00201         RETLW    0XC2   ;       ; 4775об/мин  75,6%
08C0   34C2           00202         RETLW    0XC2   ;       ; 4800об/мин  75,6%
08C1   34C1           00203         RETLW    0XC1   ;       ; 4825об/мин  75,5%
08C2   34C1           00204         RETLW    0XC1   ;       ; 4850об/мин  75,5%
08C3   34C1           00205         RETLW    0XC1   ;       ; 4875об/мин  75,4%
08C4   34C1           00206         RETLW    0XC1   ;       ; 4900об/мин  75,4%
08C5   34C1           00207         RETLW    0XC1   ;       ; 4925об/мин  75,4%
08C6   34C1           00208         RETLW    0XC1   ;       ; 4950об/мин  75,3%
08C7   34C1           00209         RETLW    0XC1   ;       ; 4975об/мин  75,3%
08C8   34C1           00210         RETLW    0XC1   ;       ; 5000об/мин  75,2%
08C9   34C1           00211         RETLW    0XC1   ;       ; 5025об/мин  75,2%
08CA   34C1           00212         RETLW    0XC1   ;       ; 5050об/мин  75,2%
08CB   34C0           00213         RETLW    0XC0   ;       ; 5075об/мин  75,1%
08CC   34C0           00214         RETLW    0XC0   ;       ; 5100об/мин  75,1%
08CD   34C0           00215         RETLW    0XC0   ;       ; 5125об/мин  75%
08CE   34C0           00216         RETLW    0XC0   ;       ; 5150об/мин  75%
08CF   34C0           00217         RETLW    0XC0   ;       ; 5175об/мин  75%
08D0   34C0           00218         RETLW    0XC0   ;       ; 5200об/мин  74,9%
08D1   34BF           00219         RETLW    0XBF   ;       ; 5225об/мин  74,8%
08D2   34BF           00220         RETLW    0XBF   ;       ; 5250об/мин  74,6%
08D3   34BE           00221         RETLW    0XBE   ;       ; 5275об/мин  74,4%
08D4   34BE           00222         RETLW    0XBE   ;       ; 5300об/мин  74,3%
08D5   34BE           00223         RETLW    0XBE   ;       ; 5325об/мин  74,1%
08D6   34BD           00224         RETLW    0XBD   ;       ; 5350об/мин  74%
08D7   34BD           00225         RETLW    0XBD   ;       ; 5375об/мин  73,8%
08D8   34BD           00226         RETLW    0XBD   ;       ; 5400об/мин  73,7%
08D9   34BC           00227         RETLW    0XBC   ;       ; 5425об/мин  73,5%
08DA   34BC           00228         RETLW    0XBC   ;       ; 5450об/мин  73,3%
08DB   34BB           00229         RETLW    0XBB   ;       ; 5475об/мин  73,2%
08DC   34BB           00230         RETLW    0XBB   ;       ; 5500об/мин  73%
08DD   34BB           00231         RETLW    0XBB   ;       ; 5525об/мин  72,9%
08DE   34BA           00232         RETLW    0XBA   ;       ; 5550об/мин  72,7%
08DF   34BA           00233         RETLW    0XBA   ;       ; 5575об/мин  72,6%
08E0   34B9           00234         RETLW    0XB9   ;       ; 5600об/мин  72,4%
08E1   34B9           00235         RETLW    0XB9   ;       ; 5625об/мин  72,2%
08E2   34B9           00236         RETLW    0XB9   ;       ; 5650об/мин  72,1%
08E3   34B8           00237         RETLW    0XB8   ;       ; 5675об/мин  71,9%
08E4   34B8           00238         RETLW    0XB8   ;       ; 5700об/мин  71,8%
08E5   34B7           00239         RETLW    0XB7   ;       ; 5725об/мин  71,6%
08E6   34B7           00240         RETLW    0XB7   ;       ; 5750об/мин  71,4%
08E7   34B7           00241         RETLW    0XB7   ;       ; 5775об/мин  71,3%
08E8   34B6           00242         RETLW    0XB6   ;       ; 5800об/мин  71,1%
08E9   34B6           00243         RETLW    0XB6   ;       ; 5825об/мин  70,9%
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

08EA   34B5           00244         RETLW    0XB5   ;       ; 5850об/мин  70,7%
08EB   34B4           00245         RETLW    0XB4   ;       ; 5875об/мин  70,5%
08EC   34B4           00246         RETLW    0XB4   ;       ; 5900об/мин  70,3%
08ED   34B3           00247         RETLW    0XB3   ;       ; 5925об/мин  70,1%
08EE   34B3           00248         RETLW    0XB3   ;       ; 5950об/мин  69,9%
08EF   34B2           00249         RETLW    0XB2   ;       ; 5975об/мин  69,7%
08F0   34B2           00250         RETLW    0XB2   ;       ; 6000об/мин  69,6%
08F1   34B2           00251         RETLW    0XB2   ;       ; 6025об/мин  69,4%
08F2   34B1           00252         RETLW    0XB1   ;       ; 6050об/мин  69,2%
08F3   34B1           00253         RETLW    0XB1   ;       ; 6075об/мин  69%
08F4   34B0           00254         RETLW    0XB0   ;       ; 6100об/мин  68,8%
08F5   34B0           00255         RETLW    0XB0   ;       ; 6125об/мин  68,6%
08F6   34AF           00256         RETLW    0XAF   ;       ; 6150об/мин  68,4%
08F7   34AF           00257         RETLW    0XAF   ;       ; 6175об/мин  68,2%
08F8   34AE           00258         RETLW    0XAE   ;       ; 6200об/мин  68%
08F9   34AE           00259         RETLW    0XAE   ;       ; 6225об/мин  67,8%
08FA   34AD           00260         RETLW    0XAD   ;       ; 6250об/мин  67,6%
08FB   34AD           00261         RETLW    0XAD   ;       ; 6275об/мин  67,4%
08FC   34AC           00262         RETLW    0XAC   ;       ; 6300об/мин  67,2%
08FD   34AC           00263         RETLW    0XAC   ;       ; 6325об/мин  67%
08FE   34AB           00264         RETLW    0XAB   ;       ; 6350об/мин  66,8%
08FF   34AA           00265         RETLW    0XAA   ;       ; 6375об/мин  66,6%
                      01003         #include lambda.asm
                      00001 ;-----------------------------------------------------
                      00002 ;   Таблица преобразования синнала лямбда-зонда
                      00003 ;-----------------------------------------------------
                      00004 Lamb    ORG     900;-4
                      00005 ; Начало таблицы
0900   34DC           00006 RETLW    0XDC   ;1,36
0901   34D7           00007 RETLW    0XD7   ;1,34
0902   34D2           00008 RETLW    0XD2   ;1,32
0903   34CD           00009 RETLW    0XCD   ;1,3
0904   34C8           00010 RETLW    0XC8   ;1,28
0905   34C3           00011 RETLW    0XC3   ;1,26
0906   34BD           00012 RETLW    0XBD   ;1,24
0907   34B8           00013 RETLW    0XB8   ;1,22
0908   34B3           00014 RETLW    0XB3   ;1,2
0909   34AE           00015 RETLW    0XAE   ;1,18
090A   34A9           00016 RETLW    0XA9   ;1,16
090B   34A4           00017 RETLW    0XA4   ;1,14
090C   349F           00018 RETLW    0X9F   ;1,12
090D   349D           00019 RETLW    0X9D   ;1,11
090E   349C           00020 RETLW    0X9C   ;1,11
090F   349B           00021 RETLW    0X9B   ;1,11
0910   349A           00022 RETLW    0X9A   ;1,1
0911   3498           00023 RETLW    0X98   ;1,09
0912   3497           00024 RETLW    0X97   ;1,09
0913   3496           00025 RETLW    0X96   ;1,09
0914   3494           00026 RETLW    0X94   ;1,08
0915   3494           00027 RETLW    0X94   ;1,08
0916   3494           00028 RETLW    0X94   ;1,08
0917   3493           00029 RETLW    0X93   ;1,07
0918   3493           00030 RETLW    0X93   ;1,07
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0919   3493           00031 RETLW    0X93   ;1,07
091A   3492           00032 RETLW    0X92   ;1,07
091B   3492           00033 RETLW    0X92   ;1,07
091C   3492           00034 RETLW    0X92   ;1,07
091D   3492           00035 RETLW    0X92   ;1,07
091E   3491           00036 RETLW    0X91   ;1,07
091F   3491           00037 RETLW    0X91   ;1,07
0920   3491           00038 RETLW    0X91   ;1,07
0921   3490           00039 RETLW    0X90   ;1,06
0922   3490           00040 RETLW    0X90   ;1,06
0923   3490           00041 RETLW    0X90   ;1,06
0924   348F           00042 RETLW    0X8F   ;1,06
0925   348F           00043 RETLW    0X8F   ;1,06
0926   348F           00044 RETLW    0X8F   ;1,06
0927   348E           00045 RETLW    0X8E   ;1,05
0928   348E           00046 RETLW    0X8E   ;1,05
0929   348E           00047 RETLW    0X8E   ;1,05
092A   348D           00048 RETLW    0X8D   ;1,05
092B   348D           00049 RETLW    0X8D   ;1,05
092C   348D           00050 RETLW    0X8D   ;1,05
092D   348C           00051 RETLW    0X8C   ;1,05
092E   348C           00052 RETLW    0X8C   ;1,05
092F   348C           00053 RETLW    0X8C   ;1,05
0930   348B           00054 RETLW    0X8B   ;1,04
0931   348B           00055 RETLW    0X8B   ;1,04
0932   348B           00056 RETLW    0X8B   ;1,04
0933   348A           00057 RETLW    0X8A   ;1,04
0934   348A           00058 RETLW    0X8A   ;1,04
0935   3489           00059 RETLW    0X89   ;1,04
0936   3489           00060 RETLW    0X89   ;1,04
0937   3488           00061 RETLW    0X88   ;1,03
0938   3488           00062 RETLW    0X88   ;1,03
0939   3488           00063 RETLW    0X88   ;1,03
093A   3487           00064 RETLW    0X87   ;1,03
093B   3487           00065 RETLW    0X87   ;1,03
093C   3486           00066 RETLW    0X86   ;1,02
093D   3486           00067 RETLW    0X86   ;1,02
093E   3485           00068 RETLW    0X85   ;1,02
093F   3485           00069 RETLW    0X85   ;1,02
0940   3484           00070 RETLW    0X84   ;1,02
0941   3484           00071 RETLW    0X84   ;1,02
0942   3483           00072 RETLW    0X83   ;1,01
0943   3483           00073 RETLW    0X83   ;1,01
0944   3483           00074 RETLW    0X83   ;1,01
0945   3482           00075 RETLW    0X82   ;1,01
0946   3482           00076 RETLW    0X82   ;1,01
0947   3481           00077 RETLW    0X81   ;1
0948   3481           00078 RETLW    0X81   ;1
0949   3480           00079 RETLW    0X80   ;1
094A   3480           00080 RETLW    0X80   ;1
094B   347F           00081 RETLW    0X7F   ;1
094C   347F           00082 RETLW    0X7F   ;1
094D   347E           00083 RETLW    0X7E   ;0,99
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

094E   347E           00084 RETLW    0X7E   ;0,99
094F   347D           00085 RETLW    0X7D   ;0,99
0950   347D           00086 RETLW    0X7D   ;0,99
0951   347D           00087 RETLW    0X7D   ;0,99
0952   347C           00088 RETLW    0X7C   ;0,98
0953   347C           00089 RETLW    0X7C   ;0,98
0954   347B           00090 RETLW    0X7B   ;0,98
0955   347B           00091 RETLW    0X7B   ;0,98
0956   347A           00092 RETLW    0X7A   ;0,98
0957   347A           00093 RETLW    0X7A   ;0,98
0958   3479           00094 RETLW    0X79   ;0,97
0959   3479           00095 RETLW    0X79   ;0,97
095A   3478           00096 RETLW    0X78   ;0,97
095B   3478           00097 RETLW    0X78   ;0,97
095C   3478           00098 RETLW    0X78   ;0,97
095D   3477           00099 RETLW    0X77   ;0,96
095E   3477           00100 RETLW    0X77   ;0,96
095F   3476           00101 RETLW    0X76   ;0,96
0960   3476           00102 RETLW    0X76   ;0,96
0961   3476           00103 RETLW    0X76   ;0,96
0962   3476           00104 RETLW    0X76   ;0,96
0963   3476           00105 RETLW    0X76   ;0,96
0964   3475           00106 RETLW    0X75   ;0,96
0965   3475           00107 RETLW    0X75   ;0,96
0966   3475           00108 RETLW    0X75   ;0,96
0967   3475           00109 RETLW    0X75   ;0,96
0968   3475           00110 RETLW    0X75   ;0,96
0969   3475           00111 RETLW    0X75   ;0,96
096A   3475           00112 RETLW    0X75   ;0,96
096B   3475           00113 RETLW    0X75   ;0,96
096C   3475           00114 RETLW    0X75   ;0,96
096D   3475           00115 RETLW    0X75   ;0,96
096E   3475           00116 RETLW    0X75   ;0,96
096F   3475           00117 RETLW    0X75   ;0,96
0970   3474           00118 RETLW    0X74   ;0,95
0971   3474           00119 RETLW    0X74   ;0,95
0972   3474           00120 RETLW    0X74   ;0,95
0973   3474           00121 RETLW    0X74   ;0,95
0974   3474           00122 RETLW    0X74   ;0,95
0975   3474           00123 RETLW    0X74   ;0,95
0976   3474           00124 RETLW    0X74   ;0,95
0977   3474           00125 RETLW    0X74   ;0,95
0978   3474           00126 RETLW    0X74   ;0,95
0979   3474           00127 RETLW    0X74   ;0,95
097A   3474           00128 RETLW    0X74   ;0,95
097B   3474           00129 RETLW    0X74   ;0,95
097C   3474           00130 RETLW    0X74   ;0,95
097D   3473           00131 RETLW    0X73   ;0,95
097E   3473           00132 RETLW    0X73   ;0,95
097F   3473           00133 RETLW    0X73   ;0,95
0980   3473           00134 RETLW    0X73   ;0,95
0981   3473           00135 RETLW    0X73   ;0,95
0982   3473           00136 RETLW    0X73   ;0,95
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0983   3473           00137 RETLW    0X73   ;0,95
0984   3473           00138 RETLW    0X73   ;0,95
0985   3473           00139 RETLW    0X73   ;0,95
0986   3473           00140 RETLW    0X73   ;0,95
0987   3473           00141 RETLW    0X73   ;0,95
0988   3473           00142 RETLW    0X73   ;0,95
0989   3472           00143 RETLW    0X72   ;0,95
098A   3472           00144 RETLW    0X72   ;0,95
098B   3472           00145 RETLW    0X72   ;0,95
098C   3472           00146 RETLW    0X72   ;0,95
098D   3472           00147 RETLW    0X72   ;0,95
098E   3472           00148 RETLW    0X72   ;0,95
098F   3472           00149 RETLW    0X72   ;0,95
0990   3472           00150 RETLW    0X72   ;0,95
0991   3472           00151 RETLW    0X72   ;0,95
0992   3472           00152 RETLW    0X72   ;0,95
0993   3472           00153 RETLW    0X72   ;0,95
0994   3472           00154 RETLW    0X72   ;0,95
0995   3472           00155 RETLW    0X72   ;0,95
0996   3471           00156 RETLW    0X71   ;0,94
0997   3471           00157 RETLW    0X71   ;0,94
0998   3471           00158 RETLW    0X71   ;0,94
0999   3471           00159 RETLW    0X71   ;0,94
099A   3471           00160 RETLW    0X71   ;0,94
099B   3471           00161 RETLW    0X71   ;0,94
099C   3471           00162 RETLW    0X71   ;0,94
099D   3471           00163 RETLW    0X71   ;0,94
099E   3471           00164 RETLW    0X71   ;0,94
099F   3471           00165 RETLW    0X71   ;0,94
09A0   3471           00166 RETLW    0X71   ;0,94
09A1   3470           00167 RETLW    0X70   ;0,94
09A2   346F           00168 RETLW    0X6F   ;0,93
09A3   346E           00169 RETLW    0X6E   ;0,93
09A4   346D           00170 RETLW    0X6D   ;0,93
09A5   346C           00171 RETLW    0X6C   ;0,92
09A6   346C           00172 RETLW    0X6C   ;0,92
09A7   346A           00173 RETLW    0X6A   ;0,91
09A8   3469           00174 RETLW    0X69   ;0,91
09A9   3468           00175 RETLW    0X68   ;0,91
09AA   3466           00176 RETLW    0X66   ;0,9
09AB   3465           00177 RETLW    0X65   ;0,89
09AC   3464           00178 RETLW    0X64   ;0,89
09AD   3463           00179 RETLW    0X63   ;0,89
09AE   3461           00180 RETLW    0X61   ;0,88
09AF   345F           00181 RETLW    0X5F   ;0,87
09B0   345C           00182 RETLW    0X5C   ;0,86
09B1   345A           00183 RETLW    0X5A   ;0,85
09B2   3461           00184 RETLW    0X61   ;0,88
09B3   345F           00185 RETLW    0X5F   ;0,87
09B4   345C           00186 RETLW    0X5C   ;0,86
09B5   345A           00187 RETLW    0X5A   ;0,85
09B6   344D           00188 RETLW    0X4D   ;0,8
09B7   344A           00189 RETLW    0X4A   ;0,79
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

09B8   3448           00190 RETLW    0X48   ;0,78
09B9   3445           00191 RETLW    0X45   ;0,77
09BA   3443           00192 RETLW    0X43   ;0,76
09BB   3442           00193 RETLW    0X42   ;0,76
09BC   3441           00194 RETLW    0X41   ;0,75
09BD   343F           00195 RETLW    0X3F   ;0,75
09BE   343E           00196 RETLW    0X3E   ;0,74
09BF   343D           00197 RETLW    0X3D   ;0,74
09C0   343C           00198 RETLW    0X3C   ;0,73
09C1   343B           00199 RETLW    0X3B   ;0,73
09C2   343A           00200 RETLW    0X3A   ;0,73
09C3   3439           00201 RETLW    0X39   ;0,72
09C4   3438           00202 RETLW    0X38   ;0,72
09C5   3437           00203 RETLW    0X37   ;0,71
09C6   3435           00204 RETLW    0X35   ;0,71
09C7   3434           00205 RETLW    0X34   ;0,7
09C8   3432           00206 RETLW    0X32   ;0,7
09C9   3431           00207 RETLW    0X31   ;0,69
09CA   3430           00208 RETLW    0X30   ;0,69
09CB   342E           00209 RETLW    0X2E   ;0,68
09CC   342D           00210 RETLW    0X2D   ;0,68
09CD   342D           00211 RETLW    0X2D   ;0,68
09CE   342C           00212 RETLW    0X2C   ;0,67
09CF   342C           00213 RETLW    0X2C   ;0,67
09D0   342B           00214 RETLW    0X2B   ;0,67
09D1   342A           00215 RETLW    0X2A   ;0,66
09D2   342A           00216 RETLW    0X2A   ;0,66
09D3   3429           00217 RETLW    0X29   ;0,66
09D4   3428           00218 RETLW    0X28   ;0,66
09D5   3428           00219 RETLW    0X28   ;0,66
09D6   3427           00220 RETLW    0X27   ;0,65
09D7   3426           00221 RETLW    0X26   ;0,65
09D8   3426           00222 RETLW    0X26   ;0,65
09D9   3425           00223 RETLW    0X25   ;0,64
09DA   3424           00224 RETLW    0X24   ;0,64
09DB   3424           00225 RETLW    0X24   ;0,64
09DC   3423           00226 RETLW    0X23   ;0,64
09DD   3423           00227 RETLW    0X23   ;0,64
09DE   3422           00228 RETLW    0X22   ;0,63
09DF   3421           00229 RETLW    0X21   ;0,63
09E0   3421           00230 RETLW    0X21   ;0,63
09E1   3420           00231 RETLW    0X20   ;0,63
09E2   341F           00232 RETLW    0X1F   ;0,62
09E3   341F           00233 RETLW    0X1F   ;0,62
09E4   341E           00234 RETLW    0X1E   ;0,62
09E5   341D           00235 RETLW    0X1D   ;0,61
09E6   341D           00236 RETLW    0X1D   ;0,61
09E7   341C           00237 RETLW    0X1C   ;0,61
09E8   341C           00238 RETLW    0X1C   ;0,61
09E9   341B           00239 RETLW    0X1B   ;0,61
09EA   341A           00240 RETLW    0X1A   ;0,6
09EB   341A           00241 RETLW    0X1A   ;0,6
09EC   3419           00242 RETLW    0X19   ;0,6
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

09ED   3418           00243 RETLW    0X18   ;0,59
09EE   3418           00244 RETLW    0X18   ;0,59
09EF   3417           00245 RETLW    0X17   ;0,59
09F0   3416           00246 RETLW    0X16   ;0,59
09F1   3416           00247 RETLW    0X16   ;0,59
09F2   3415           00248 RETLW    0X15   ;0,58
09F3   3414           00249 RETLW    0X14   ;0,58
09F4   3414           00250 RETLW    0X14   ;0,58
09F5   3413           00251 RETLW    0X13   ;0,57
09F6   3413           00252 RETLW    0X13   ;0,57
09F7   3412           00253 RETLW    0X12   ;0,57
09F8   3411           00254 RETLW    0X11   ;0,57
09F9   3411           00255 RETLW    0X11   ;0,57
09FA   3410           00256 RETLW    0X10   ;0,56
09FB   340F           00257 RETLW    0X0F   ;0,56
09FC   340F           00258 RETLW    0X0F   ;0,56
09FD   340E           00259 RETLW    0X0E   ;0,55
09FE   340D           00260 RETLW    0X0D   ;0,55
09FF   340D           00261 RETLW    0X0D   ;0,55
                      01004 ; предварительная запись
                      01005             org         2100h       ; Обращение к EEPROM памяти данных.
2100   0008 0004 0002 01006             DE          8h,4h,2h   
2103   0001 0003 0005 01007             DE          1h,3h,5h,7h,8h,6h,4h,2h         
       0007 0008 0006 
       0004 0002 
                      01008 ;Хранение счётчика моточасов
                      01009             org         2100h+0F0H  ; Обращение к EEPROM памяти данных.
21F0   0000 0000 0002 01010 MH_main     DE          00h,00h,2h      ; Часы.HSB:Часы.LSB:КС
21F3   0000 0000 0002 01011 MH_res      DE          00h,00h,2h
21F6   0000 0000      01012 MH_min_m    DE          00h,00h
21F8   0000 0000      01013 MH_min_r    DE          00h,00h  
                      01014 ;       ORG     1F9CH 
                      01015 ;       PAGESEL         GO_INIT
                      01016 ;       GOTO    GO_INIT
                      01017 ;       nop
                      01018 ;       nop
                      01019 ;Bootloader org         1FA0H
                      01020 
3F76                  01021         END                       ; directive 'end of program'
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 61


SYMBOL TABLE
  LABEL                             VALUE 

ACCEL                             PORTB,5
ACCEL_CORR                        
ACCL                              000005E0
ACCL_END                          00000561
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACLEE                             00000558
ACL_THR                           05H
ADC01                             00000207
ADC02                             00000229
ADC03                             00000237
ADC1                              000001B2
ADC2                              000001B9
ADC3                              000001C0
ADC4                              000001C7
ADC5                              000001D0
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADC_COLT                          b'10010001'
ADC_CORR                          b'10100001'
ADC_MAP                           b'10000001'
ADC_POWER                         000000AA
ADC_PWR                           b'10011001'
ADC_SEL                           00000000
ADC_SELECT                        000001AA
ADC_TPS                           b'10001001'
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AF                                00000000
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
BT_CNT                            00000001
BUF_IND                           0000004A
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CALC                              000004F8
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 62


SYMBOL TABLE
  LABEL                             VALUE 

CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHK_SUM_RX                        00000026
CHK_SUM_TX                        00000025
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CKE                               00000006
CKP                               00000004
CLR_IAC                           00000215
CLR_TX                            000001F0
CLWWHTDEL                         00000467
CLWWHTDELWR                       0000048E
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
COLT                              00000008
COLT_ERR                          00000286
COLT_MID                          0000051A
COLT_MID2                         0000050B
COLT_MID3                         0000052B
COMP_EVNT                         0000014B
CORR                              000000D0
CORR_LAG                          000000DF
CORR_RCO                          000000DF
CRANK_COLT                        .30000
CRANK_HOT                         .3000
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 63


SYMBOL TABLE
  LABEL                             VALUE 

CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
CYL                               .4
Cnt                               0000002C
Cnt2                              00000034
CntDiv                            0000003E
ColtF                             00000007
Corr                              000005E6
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DEL                               000001E2
DEL1                              000001DD
DELAY                             000001DA
DELEY20                           000001E7
DELT_DEL                          000004BB
DELT_DEL_UP                       000004C8
DEL_LOOP                          000004C3
DEL_LOOP_UP                       000004D0
DEMFER                            .26
DEMFEROUT                         0000043C
D_A                               00000005
D_ACCL                            0000055C
D_NOT_A                           00000005
D_TPS                             0000001D
D_TPS1                            00000009
Div24_16                          0000032D
DivHi                             00000036
DivLo                             00000035
ECON                              00000591
ECON_CORR                         
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
EE_ADR                            0000030F
EE_READ                           00000315
EE_WRITE                          0000031E
EMR_OFF                           00000590
ENR_12                            0000001E
ENR_COEFF                         D'1244'
ENR_TPS                           D'1339'
EPHH                              PORTC,2
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 64


SYMBOL TABLE
  LABEL                             VALUE 

ERR                               00000005
ERR_BOR                           000001EA
EXT                               000005F3
EXT2                              000005F2
EngSC                             00000800
EqlOut                            000005C4
F                                 00000001
FERR                              00000002
FLAG                              00000001
FLAG2                             00000002
FL_CLEAR                          .3027
FSR                               00000004
FinDiv                            000003A6
FinSub                            00000368
Fin_Mul                           00000618
Flag_Math                         00000045
GCEN                              00000007
GC_1                              0000028A
GETLAG                            000002B4
GET_ACCEL                         00000541
GET_COLT                          0000025A
GET_DAD                           00000218
GIE                               00000007
GO                                00000002
GO_BOOT                           00000000
GO_DONE                           00000002
GO_INIT                           00000000
GO_MAP                            00000539
GO_NOT_DONE                       00000002
HCNSET                            00000199
HVOLT                             00000305
H_byte                            00000048
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IAC_COLT                          D'100'
IAC_INIT                          00000003
IAC_MAX                           D'120'
IAC_MIN                           D'8'
IAC_SKIP                          .600
IAC_TRSH                          D'20'
IAC_WARM                          D'25'
IGN                               PORTC,0
INDF                              00000000
INIT                              0000001E
INJ1                              PORTB,1
INJ2                              PORTB,4
INJ3                              PORTB,6
INJ4                              PORTB,7
INJ5                              PORTC,1
INJ6                              PORTC,3
INJ_CLS                           00000172
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 65


SYMBOL TABLE
  LABEL                             VALUE 

INJ_HOLD                          00000155
INJ_LAG_H                         00000011
INJ_LAG_L                         00000010
INJ_LOAD                          0000015D
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
Int_AD                            000001FE
Int_RX                            00000257
LAG                               0000028F
LAG086                            .1900
LAG102                            .1510
LAG118                            .1100
LAG134                            .880
LAG150                            .700
LVOLT                             0000030A
L_byte                            00000049
Lamb                              00000900
Ln_Int                            000005A7
MAIN                              0000009B
MANSETIAC                         
MANSETRqF                         
MAN_CORR                          00000022
MAP                               00000009
MCKh                              00000017
MCKl                              00000016
MH_main                           000021F0
MH_min_m                          000021F6
MH_min_r                          000021F8
MH_res                            000021F3
MINUTE_CNT                        000000AE
MTR_OFF                           00000120
MTR_ON                            0000011D
MUL16_8                           000005F8
MUL8                              000003D8
MULT                              
MUL_ENR                           00000587
MULc                              00000046
MULp                              00000047
M_CALC                            000004D5
M_SPD                             000000E0
Ml_1                              00000609
Ml_2                              0000060E
Ml_3                              000005FF
Ml_4                              00000613
Ml_5                              00000610
Mul1Hi                            00000032
Mul1Lo                            00000031
Mul2                              0000003D
Mul2Hi                            00000038
Mul2Lo                            00000037
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 66


SYMBOL TABLE
  LABEL                             VALUE 

NEXT                              000000AA
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
NTX11V                            000002D7
NX                                000000A7
NX2                               000000AC
O2S                               0000000B
O2SET                             00000250
O2S_OFF                           00000254
O2Zr                              0000024E
OERR                              00000001
OFFSET                            .38
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCLATH_TEMP                       0000000D
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIN1                              PORTA,4
PIR1                              0000000C
PIR2                              0000000D
PMPC                              00000028
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
POWER                             0000000C
PR2                               00000092
PR_PULSE                          .5000
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PUMP                              PORTC,4
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 67


SYMBOL TABLE
  LABEL                             VALUE 

PWR086                            000002C5
PWR102                            000002CE
PWR118                            000002D9
PWR134                            000002E2
PWR_BUF                           000000A5
PWR_BUF_IND                       000000A9
PWR_CALC                          000002EB
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCOh                              00000015
RCOl                              00000014
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_STR                          000001F6
READ_STR2                         000001FA
READ_WRITE                        00000002
RESERV                            0000001F
RET                               00000017
RP0                               00000005
RP1                               00000006
RQF2                              0000004B
RSEN                              00000001
RX9                               00000006
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 68


SYMBOL TABLE
  LABEL                             VALUE 

RX9D                              00000000
RX_DATA                           000000AB
R_NOT_W                           00000002
R_W                               00000002
Read_RX                           00000259
ReqFuel                           .4500
Res1                              0000003A
Res2                              0000003B
Res2Hi                            00000039
Res3                              0000003C
ResHi                             00000033
RqFh                              00000013
RqFl                              00000012
S                                 00000003
SAME                              00000001
SEL                               000001D7
SEN                               00000000
SETPOR                            00000037
SETSTP                            00000420
SET_ADC_TPS                       000001D4
SET_MAN                           0000041E
SET_STEP                          00000417
SIZE                              00000003
SLOPE                             .242
SMP                               00000007
SPARK                             00000123
SPBRG                             00000099
SPD                               0000000D
SPD_BUF                           000000A1
SPD_BUF_IND                       000000A0
SPD_CONST                         .2400000/CYL
SPD_E                             0000056A
SPD_ENR                           00000023
SPD_EPHH                          .1600
SPD_HOT                           .850
SPD_INTPL                         000000F9
SPD_NULL                          0000011F
SPD_WARM                          .1250
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 69


SYMBOL TABLE
  LABEL                             VALUE 

STAB                              00000426
STABH                             00000454
STABHWR                           0000047B
STABILIZE                         00000442
STABOPN                           00000452
STABSTAT                          00000435
STAT                              00000004
STATUS                            00000003
STATUS_TEMP                       0000000C
STDA0                             000004B5
STDB0                             000004B3
STDB20                            000004B9
STEPA                             PORTB,2
STEPB                             PORTB,3
STPCNT                            00000006
STPD                              000004A4
STPDOWN                           000004AD
STPI                              000003FF
STPINIT                           000003FD
STPUP                             00000490
STP_CNT_DWN                       0000002A
STP_CNT_UP                        00000027
STP_SPEED                         00000029
STUA0                             0000049E
STUB0                             0000049C
STUB20                            000004A2
ST_INI                            00000407
SYNC                              00000004
Sreslt                            000005C0
StartDiv                          00000362
Sub                               000003BF
Sub_                              0000061D
Subnd                             0000062C
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TEMP                              0000000A
TEMP_MULT                         000000AF
TIME_DIV                          000000AC
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 70


SYMBOL TABLE
  LABEL                             VALUE 

TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TMRH                              00000008
TMRL                              00000007
TMRM2                             00000181
TMRM3                             00000187
TMROUT                            000001A7
TMR_EV                            0000017B
TMR_EX                            00000187
TMR_OF                            00000169
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TPS                               0000000A
TPS1                              0000002B
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRMT                              00000001
TRSHH                             (WARM_TRSH+.273)*.51
TR_EN                             0000057F
TX                                000000BF
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 71


SYMBOL TABLE
  LABEL                             VALUE 

TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
TX_DEL_CNT                        00000004
T_INJ_H                           0000000F
T_INJ_L                           0000000E
Temp                              0000003F
Temp1                             00000040
Temp2                             00000041
Temp3                             00000042
Temp4                             00000043
Temp5                             00000044
Temp6                             0000002D
Temp7                             0000002E
Temp8                             0000002F
Temp9                             00000030
Tmp                               Flag_Math,0
Tmp2                              Flag_Math,1
UA                                00000001
UOZ                               00000021
VERSION                           00000002
VE_CORR                           
W                                 00000000
WARM_20                           00000019
WARM_40                           0000001B
WARM_50                           0000001C
WARM_80                           00000018
WARM_CORR                         
WARM_ENR                          00000024
WARM_ENR_12                       090H
WARM_ENR_20                       04BH
WARM_ENR_40                       0FFH
WARM_ENR_50                       018H
WARM_ENR_80                       00H
WARM_TRSH                         D'40'
WARM_UP                           PORTC,3
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WRT_CNTR                          000000CE
WST                               00000469
WTGO1                             00000091
W_TEMP                            0000000E
Warm_Enr                          000005D4
Z                                 00000002
_.org_1_00EF                      000000EF
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 72


SYMBOL TABLE
  LABEL                             VALUE 

_.org_1_00FF                      000000FF
_.org_1_018A                      0000018A
_.org_1_018D                      0000018D
_.org_1_0220                      00000220
_.org_1_0289                      00000289
_.org_1_029C                      0000029C
_.org_1_04BD                      000004BD
_.org_1_04CA                      000004CA
_.org_1_04DC                      000004DC
_.org_1_0553                      00000553
_.org_1_0555                      00000555
_.org_1_0563                      00000563
_.org_1_0597                      00000597
_.org_1_05B4                      000005B4
_.org_1_05E4                      000005E4
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
__16F876A                         00000001
MPASM  5.51                      WEGA_876.ASM   10-13-2021  20:12:04         PAGE 73


SYMBOL TABLE
  LABEL                             VALUE 

add2nd                            0000036F
bank0                             
bank1                             
bank2                             
bank3                             
chknxt                            0000033F
chknxt1                           00000353
chknxt2                           0000035C
cxv                               000003B3
dil_t                             00000005
dil_t2                            00000006
dilt                              000001E4
dsgfadsg                          000003B8
eSTAT                             0000001A
ffr                               00000380
first_address                     1fffh-.100+.1
hctn                              .6000
jc                                
jjddsak                           000003A4
jnc                               
jnz                               
jpqm                              00000374
jz                                
let                               
movab                             
nnhjuq                            0000037E
nnhq                              000003A1
notFin                            00000386
sbagn                             00000362
sub2nd                            000003CE
temp                              0000000B

Errors   :     0
Warnings :     0 reported,   287 suppressed
Messages :     0 reported,    28 suppressed

